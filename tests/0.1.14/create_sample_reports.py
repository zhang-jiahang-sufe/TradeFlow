#!/usr/bin/env python3
"""
åˆ›å»ºç¤ºä¾‹åˆ†ææŠ¥å‘Š
ç”¨äºæµ‹è¯•Webç•Œé¢çš„æŠ¥å‘Šæ˜¾ç¤ºåŠŸèƒ½
"""

import sys
import os
from datetime import datetime

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.append(os.path.join(os.path.dirname(__file__), 'web'))

def create_sample_report(stock_symbol: str, stock_name: str):
    """åˆ›å»ºç¤ºä¾‹åˆ†ææŠ¥å‘Š"""
    
    # åˆ†æç»“æœæ•°æ®
    analysis_results = {
        "summary": f"{stock_name}({stock_symbol}) ç»¼åˆåˆ†ææ˜¾ç¤ºè¯¥è‚¡ç¥¨å…·æœ‰è‰¯å¥½çš„æŠ•èµ„æ½œåŠ›ï¼Œå»ºè®®å…³æ³¨ã€‚",
        "analysts": ["market_analyst", "fundamentals_analyst", "trader_agent"]
    }
    
    # æŠ¥å‘Šå†…å®¹
    reports = {
        "final_trade_decision": f"""# {stock_name}({stock_symbol}) æœ€ç»ˆäº¤æ˜“å†³ç­–

## ğŸ“Š æŠ•èµ„å»ºè®®
**è¡ŒåŠ¨**: ä¹°å…¥
**ç½®ä¿¡åº¦**: 85%
**é£é™©è¯„åˆ†**: 25%
**ç›®æ ‡ä»·æ ¼**: å½“å‰ä»·æ ¼ä¸Šæ¶¨15-20%

## ğŸ¯ å…³é”®è¦ç‚¹
- æŠ€æœ¯é¢æ˜¾ç¤ºä¸Šæ¶¨è¶‹åŠ¿
- åŸºæœ¬é¢è´¢åŠ¡çŠ¶å†µè‰¯å¥½
- å¸‚åœºæƒ…ç»ªç§¯æ
- é£é™©å¯æ§

## ğŸ’¡ åˆ†ææ¨ç†
åŸºäºå¤šç»´åº¦åˆ†æï¼Œè¯¥è‚¡ç¥¨åœ¨æŠ€æœ¯é¢ã€åŸºæœ¬é¢å’Œå¸‚åœºæƒ…ç»ªæ–¹é¢éƒ½è¡¨ç°è‰¯å¥½ã€‚æŠ€æœ¯æŒ‡æ ‡æ˜¾ç¤ºçªç ´å…³é”®é˜»åŠ›ä½ï¼Œæˆäº¤é‡æ”¾å¤§ç¡®è®¤ä¸Šæ¶¨è¶‹åŠ¿ã€‚åŸºæœ¬é¢åˆ†ææ˜¾ç¤ºå…¬å¸è´¢åŠ¡ç¨³å¥ï¼Œç›ˆåˆ©èƒ½åŠ›å¼ºã€‚ç»¼åˆè¯„ä¼°å»ºè®®ä¹°å…¥å¹¶æŒæœ‰ã€‚

## âš ï¸ é£é™©æç¤º
- å¸‚åœºæ•´ä½“æ³¢åŠ¨é£é™©
- è¡Œä¸šæ”¿ç­–å˜åŒ–é£é™©
- å»ºè®®è®¾ç½®æ­¢æŸä½
""",

        "fundamentals_report": f"""# {stock_name}({stock_symbol}) åŸºæœ¬é¢åˆ†ææŠ¥å‘Š

## ğŸ“ˆ è´¢åŠ¡æŒ‡æ ‡åˆ†æ
### ç›ˆåˆ©èƒ½åŠ›
- **å‡€åˆ©æ¶¦å¢é•¿ç‡**: 15.2% (åŒæ¯”)
- **ROE**: 18.5%
- **ROA**: 12.3%
- **æ¯›åˆ©ç‡**: 35.8%

### å¿å€ºèƒ½åŠ›
- **èµ„äº§è´Ÿå€ºç‡**: 45.2%
- **æµåŠ¨æ¯”ç‡**: 2.1
- **é€ŸåŠ¨æ¯”ç‡**: 1.8
- **åˆ©æ¯ä¿éšœå€æ•°**: 8.5

### è¿è¥èƒ½åŠ›
- **æ€»èµ„äº§å‘¨è½¬ç‡**: 1.2
- **å­˜è´§å‘¨è½¬ç‡**: 6.8
- **åº”æ”¶è´¦æ¬¾å‘¨è½¬ç‡**: 9.2

## ğŸ¢ å…¬å¸åŸºæœ¬æƒ…å†µ
- **è¡Œä¸šåœ°ä½**: è¡Œä¸šé¾™å¤´ä¼ä¸š
- **ä¸»è¥ä¸šåŠ¡**: ç¨³å®šå¢é•¿
- **å¸‚åœºä»½é¢**: æŒç»­æ‰©å¤§
- **ç«äº‰ä¼˜åŠ¿**: æŠ€æœ¯é¢†å…ˆï¼Œå“ç‰ŒçŸ¥ååº¦é«˜

## ğŸ“Š ä¼°å€¼åˆ†æ
- **PE**: 15.2å€ (åˆç†ä¼°å€¼åŒºé—´)
- **PB**: 2.1å€
- **PEG**: 0.8 (ä½äº1ï¼Œå…·æœ‰æŠ•èµ„ä»·å€¼)

## ğŸ’° æŠ•èµ„äº®ç‚¹
1. è´¢åŠ¡çŠ¶å†µç¨³å¥ï¼Œç›ˆåˆ©èƒ½åŠ›å¼º
2. è¡Œä¸šåœ°ä½ç¨³å›ºï¼Œç«äº‰ä¼˜åŠ¿æ˜æ˜¾
3. ä¼°å€¼åˆç†ï¼Œå…·æœ‰æŠ•èµ„ä»·å€¼
4. åˆ†çº¢æ”¿ç­–ç¨³å®šï¼Œè‚¡ä¸œå›æŠ¥è‰¯å¥½
""",

        "market_report": f"""# {stock_name}({stock_symbol}) æŠ€æœ¯é¢åˆ†ææŠ¥å‘Š

## ğŸ“ˆ ä»·æ ¼è¶‹åŠ¿åˆ†æ
### çŸ­æœŸè¶‹åŠ¿ (5-20æ—¥)
- **è¶‹åŠ¿æ–¹å‘**: ä¸Šæ¶¨
- **æ”¯æ’‘ä½**: Â¥45.20
- **é˜»åŠ›ä½**: Â¥52.80
- **å½“å‰ä½ç½®**: çªç ´å‰æœŸé«˜ç‚¹

### ä¸­æœŸè¶‹åŠ¿ (20-60æ—¥)
- **è¶‹åŠ¿æ–¹å‘**: ä¸Šæ¶¨
- **ä¸»è¦æ”¯æ’‘**: Â¥42.50
- **ç›®æ ‡ä½**: Â¥55.00
- **è¶‹åŠ¿å¼ºåº¦**: å¼º

## ğŸ“Š æŠ€æœ¯æŒ‡æ ‡åˆ†æ
### è¶‹åŠ¿æŒ‡æ ‡
- **MA5**: 48.50 (ä»·æ ¼åœ¨å‡çº¿ä¸Šæ–¹)
- **MA20**: 46.80 (å¤šå¤´æ’åˆ—)
- **MA60**: 44.20 (é•¿æœŸä¸Šæ¶¨è¶‹åŠ¿)

### åŠ¨é‡æŒ‡æ ‡
- **RSI(14)**: 68.5 (åå¼ºï¼Œæœªè¶…ä¹°)
- **MACD**: é‡‘å‰å‘ä¸Š
- **KDJ**: K=75, D=68, J=82 (å¼ºåŠ¿åŒºåŸŸ)

### æˆäº¤é‡åˆ†æ
- **æˆäº¤é‡**: æ”¾é‡ä¸Šæ¶¨
- **é‡ä»·å…³ç³»**: ä»·æ¶¨é‡å¢ï¼Œå¥åº·ä¸Šæ¶¨
- **æ¢æ‰‹ç‡**: 3.2% (æ´»è·ƒ)

## ğŸ¯ æ“ä½œå»ºè®®
### ä¹°å…¥ä¿¡å·
- çªç ´å‰æœŸé«˜ç‚¹
- æˆäº¤é‡é…åˆ
- æŠ€æœ¯æŒ‡æ ‡å‘å¥½

### å…³é”®ä½ç½®
- **ä¹°å…¥ä½**: Â¥48.00-49.00
- **æ­¢æŸä½**: Â¥45.00
- **ç›®æ ‡ä½**: Â¥55.00

## âš ï¸ é£é™©æç¤º
- æ³¨æ„å¤§ç›˜æ•´ä½“èµ°åŠ¿
- å…³æ³¨æˆäº¤é‡å˜åŒ–
- è®¾ç½®åˆç†æ­¢æŸä½
"""
    }
    
    return analysis_results, reports

def main():
    """ä¸»å‡½æ•°"""
    print("ğŸ¨ åˆ›å»ºç¤ºä¾‹åˆ†ææŠ¥å‘Š...")
    
    try:
        from web.utils.mongodb_report_manager import mongodb_report_manager
        
        if not mongodb_report_manager.connected:
            print("âŒ MongoDBæœªè¿æ¥")
            return
        
        # åˆ›å»ºå¤šä¸ªç¤ºä¾‹æŠ¥å‘Š
        sample_stocks = [
            ("DEMO001", "ç¤ºä¾‹ç§‘æŠ€è‚¡"),
            ("DEMO002", "ç¤ºä¾‹é“¶è¡Œè‚¡"),
            ("DEMO003", "ç¤ºä¾‹æ¶ˆè´¹è‚¡"),
            ("000001", "å¹³å®‰é“¶è¡Œ"),
            ("000002", "ä¸‡ç§‘A")
        ]
        
        success_count = 0
        
        for stock_symbol, stock_name in sample_stocks:
            print(f"ğŸ“ åˆ›å»º {stock_name}({stock_symbol}) çš„åˆ†ææŠ¥å‘Š...")
            
            analysis_results, reports = create_sample_report(stock_symbol, stock_name)
            
            success = mongodb_report_manager.save_analysis_report(
                stock_symbol=stock_symbol,
                analysis_results=analysis_results,
                reports=reports
            )
            
            if success:
                success_count += 1
                print(f"âœ… {stock_name} æŠ¥å‘Šåˆ›å»ºæˆåŠŸ")
            else:
                print(f"âŒ {stock_name} æŠ¥å‘Šåˆ›å»ºå¤±è´¥")
        
        print(f"\nğŸ‰ å®Œæˆï¼æˆåŠŸåˆ›å»º {success_count}/{len(sample_stocks)} ä¸ªç¤ºä¾‹æŠ¥å‘Š")
        print("ğŸ’¡ ç°åœ¨å¯ä»¥åœ¨Webç•Œé¢ä¸­æŸ¥çœ‹è¿™äº›æŠ¥å‘Šäº†")
        
    except Exception as e:
        print(f"âŒ åˆ›å»ºç¤ºä¾‹æŠ¥å‘Šå¤±è´¥: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    main()
