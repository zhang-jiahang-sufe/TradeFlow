# å¯¼å‡ºé…ç½®æ•°æ®ç”¨äºæ¼”ç¤ºç³»ç»Ÿéƒ¨ç½²

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œå¯¼å‡ºé…ç½®æ•°æ®ç”¨äºåœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²æ¼”ç¤ºç³»ç»Ÿã€‚

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

å½“æ‚¨éœ€è¦åœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²æ¼”ç¤ºç³»ç»Ÿæ—¶ï¼Œå¯ä»¥ï¼š
- âœ… **ä¿ç•™**ï¼šç³»ç»Ÿé…ç½®ã€LLM é…ç½®ã€ç”¨æˆ·æ•°æ®ç­‰é…ç½®ä¿¡æ¯
- âŒ **ä¸ä¿ç•™**ï¼šåˆ†ææŠ¥å‘Šã€è‚¡ç¥¨æ•°æ®ã€å†å²è®°å½•ç­‰ä¸šåŠ¡æ•°æ®

è¿™æ ·å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªåŒ…å«å®Œæ•´é…ç½®çš„æ¼”ç¤ºç¯å¢ƒï¼Œè€Œä¸éœ€è¦é‡æ–°é…ç½® 15 ä¸ª LLM æ¨¡å‹ã€‚

---

## ğŸš€ æ“ä½œæ­¥éª¤

### 1. å¯¼å‡ºé…ç½®æ•°æ®

#### æ–¹æ³• 1ï¼šä½¿ç”¨å‰ç«¯ç•Œé¢ï¼ˆæ¨èï¼‰

1. **ç™»å½•ç³»ç»Ÿ**
   - è®¿é—®å‰ç«¯ç•Œé¢
   - ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•

2. **è¿›å…¥æ•°æ®åº“ç®¡ç†é¡µé¢**
   - å¯¼èˆªåˆ°ï¼š`ç³»ç»Ÿç®¡ç†` â†’ `æ•°æ®åº“ç®¡ç†`

3. **å¯¼å‡ºé…ç½®æ•°æ®**
   - åœ¨"æ•°æ®å¯¼å‡º"åŒºåŸŸï¼š
     - **å¯¼å‡ºæ ¼å¼**ï¼šé€‰æ‹© `JSON`ï¼ˆæ¨èï¼‰
     - **æ•°æ®é›†åˆ**ï¼šé€‰æ‹© `é…ç½®æ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºç³»ç»Ÿï¼‰`
   - ç‚¹å‡»"å¯¼å‡ºæ•°æ®"æŒ‰é’®
   - æµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸‹è½½æ–‡ä»¶ï¼š`database_export_config_YYYY-MM-DD.json`

#### æ–¹æ³• 2ï¼šä½¿ç”¨ API

```bash
# ä½¿ç”¨ curl å¯¼å‡ºé…ç½®æ•°æ®
curl -X POST "http://localhost:8000/api/system/database/export" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "collections": [
      "system_configs",
      "users",
      "llm_providers",
      "market_categories",
      "user_tags",
      "datasource_groupings",
      "platform_configs",
      "user_configs",
      "model_catalog",
      "market_quotes",
      "stock_basic_info"
    ],
    "format": "json"
  }' \
  --output config_export.json
```

---

### 2. ä¼ è¾“åˆ°æ–°æœåŠ¡å™¨

å°†å¯¼å‡ºçš„æ–‡ä»¶ä¼ è¾“åˆ°æ–°æœåŠ¡å™¨ï¼š

```bash
# ä½¿ç”¨ scp
scp database_export_config_2025-10-16.json user@new-server:/path/to/destination/

# æˆ–ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼ˆFTPã€äº‘å­˜å‚¨ç­‰ï¼‰
```

---

### 3. åœ¨æ–°æœåŠ¡å™¨ä¸Šå¯¼å…¥

#### æ–¹æ³• 1ï¼šä½¿ç”¨å‰ç«¯ç•Œé¢ï¼ˆæ¨èï¼‰

1. **ç¡®ä¿æ–°æœåŠ¡å™¨å·²éƒ¨ç½²**
   - MongoDB å®¹å™¨æ­£åœ¨è¿è¡Œ
   - åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ
   - å‰ç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ

2. **ç™»å½•æ–°æœåŠ¡å™¨çš„å‰ç«¯**
   - ä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼ˆå¦‚æœæ˜¯å…¨æ–°éƒ¨ç½²ï¼‰

3. **å¯¼å…¥é…ç½®æ•°æ®**
   - å¯¼èˆªåˆ°ï¼š`ç³»ç»Ÿç®¡ç†` â†’ `æ•°æ®åº“ç®¡ç†`
   - åœ¨"æ•°æ®å¯¼å…¥"åŒºåŸŸï¼š
     - é€‰æ‹©è¦å¯¼å…¥çš„é›†åˆï¼ˆæˆ–é€‰æ‹©"è¦†ç›–æ‰€æœ‰"ï¼‰
     - ä¸Šä¼ å¯¼å‡ºçš„ JSON æ–‡ä»¶
     - å‹¾é€‰"è¦†ç›–ç°æœ‰æ•°æ®"ï¼ˆå¦‚æœéœ€è¦ï¼‰
   - ç‚¹å‡»"å¯¼å…¥æ•°æ®"æŒ‰é’®

4. **é‡å¯åç«¯æœåŠ¡**
   ```bash
   docker restart tradingagents-backend
   ```

#### æ–¹æ³• 2ï¼šä½¿ç”¨ API

```bash
# å¯¼å…¥é…ç½®æ•°æ®
curl -X POST "http://new-server:8000/api/system/database/import" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@database_export_config_2025-10-16.json" \
  -F "collection=system_configs" \
  -F "format=json" \
  -F "overwrite=true"
```

---

## ğŸ“¦ å¯¼å‡ºçš„é…ç½®æ•°æ®åŒ…å«

| é›†åˆåç§° | è¯´æ˜ | é‡è¦æ€§ |
|---------|------|--------|
| `system_configs` | ç³»ç»Ÿé…ç½®ï¼ˆåŒ…æ‹¬ 15 ä¸ª LLM é…ç½®ï¼‰ | â­â­â­â­â­ |
| `users` | ç”¨æˆ·è´¦å·å’Œæƒé™ | â­â­â­â­â­ |
| `llm_providers` | LLM æä¾›å•†ä¿¡æ¯ | â­â­â­â­ |
| `market_categories` | å¸‚åœºåˆ†ç±»é…ç½® | â­â­â­ |
| `user_tags` | ç”¨æˆ·æ ‡ç­¾é…ç½® | â­â­â­ |
| `datasource_groupings` | æ•°æ®æºåˆ†ç»„é…ç½® | â­â­â­ |
| `platform_configs` | å¹³å°é…ç½® | â­â­â­ |
| `user_configs` | ç”¨æˆ·ä¸ªæ€§åŒ–é…ç½® | â­â­ |
| `model_catalog` | æ¨¡å‹ç›®å½• | â­â­ |
| `market_quotes` | å®æ—¶è¡Œæƒ…æ•°æ® | â­â­â­â­ |
| `stock_basic_info` | è‚¡ç¥¨åŸºç¡€ä¿¡æ¯ | â­â­â­â­ |

### åŒ…å«çš„ LLM é…ç½®ï¼ˆ15 ä¸ªï¼‰

å¯¼å‡ºçš„é…ç½®æ•°æ®åŒ…å«ä»¥ä¸‹å·²å¯ç”¨çš„ LLM æ¨¡å‹ï¼š

```
âœ… Google Gemini
   - gemini-2.5-pro
   - gemini-2.5-flash

âœ… DeepSeek
   - deepseek-chat

âœ… ç™¾åº¦åƒå¸†
   - ernie-3.5-8k
   - ernie-4.0-turbo-8k

âœ… é˜¿é‡Œç™¾ç‚¼ (DashScope)
   - qwen3-max
   - qwen-flash
   - qwen-plus
   - qwen-turbo

âœ… OpenRouter
   - anthropic/claude-sonnet-4.5
   - openai/gpt-5
   - google/gemini-2.5-pro
   - google/gemini-2.5-flash
   - openai/gpt-3.5-turbo
   - google/gemini-2.0-flash-001
```

---

## âŒ ä¸å¯¼å‡ºçš„æ•°æ®

ä»¥ä¸‹æ•°æ®**ä¸ä¼š**è¢«å¯¼å‡ºï¼ˆèŠ‚çœç©ºé—´å’Œæ—¶é—´ï¼‰ï¼š

| é›†åˆåç§° | è¯´æ˜ | åŸå›  |
|---------|------|------|
| `analysis_reports` | åˆ†ææŠ¥å‘Š | æ¼”ç¤ºç³»ç»Ÿä¸éœ€è¦å†å²æŠ¥å‘Š |
| `analysis_tasks` | åˆ†æä»»åŠ¡ | æ¼”ç¤ºç³»ç»Ÿä¸éœ€è¦å†å²ä»»åŠ¡ |
| `stock_basic_info` | è‚¡ç¥¨åŸºç¡€ä¿¡æ¯ | æ•°æ®é‡å¤§ï¼Œå¯é‡æ–°åŒæ­¥ |
| `market_quotes` | å¸‚åœºè¡Œæƒ… | å®æ—¶æ•°æ®ï¼Œå¯é‡æ–°è·å– |
| `stock_daily_quotes` | æ—¥çº¿è¡Œæƒ… | æ•°æ®é‡å¤§ï¼Œå¯é‡æ–°åŒæ­¥ |
| `financial_data_cache` | è´¢åŠ¡æ•°æ®ç¼“å­˜ | ç¼“å­˜æ•°æ®ï¼Œå¯é‡æ–°ç”Ÿæˆ |
| `financial_metrics_cache` | è´¢åŠ¡æŒ‡æ ‡ç¼“å­˜ | ç¼“å­˜æ•°æ®ï¼Œå¯é‡æ–°ç”Ÿæˆ |
| `operation_logs` | æ“ä½œæ—¥å¿— | æ¼”ç¤ºç³»ç»Ÿä¸éœ€è¦å†å²æ—¥å¿— |
| `scheduler_history` | è°ƒåº¦å†å² | æ¼”ç¤ºç³»ç»Ÿä¸éœ€è¦å†å²è®°å½• |
| `token_usage` | Token ä½¿ç”¨è®°å½• | æ¼”ç¤ºç³»ç»Ÿä¸éœ€è¦å†å²è®°å½• |
| `usage_records` | ä½¿ç”¨è®°å½• | æ¼”ç¤ºç³»ç»Ÿä¸éœ€è¦å†å²è®°å½• |
| `notifications` | é€šçŸ¥æ¶ˆæ¯ | æ¼”ç¤ºç³»ç»Ÿä¸éœ€è¦å†å²é€šçŸ¥ |

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. API å¯†é’¥å®‰å…¨

å¯¼å‡ºçš„é…ç½®æ•°æ®åŒ…å« LLM å’Œæ•°æ®æºçš„ API å¯†é’¥ï¼Œè¯·ï¼š
- âœ… å¦¥å–„ä¿ç®¡å¯¼å‡ºæ–‡ä»¶
- âœ… ä½¿ç”¨åŠ å¯†ä¼ è¾“ï¼ˆHTTPSã€SCPï¼‰
- âœ… ä¼ è¾“ååˆ é™¤ä¸´æ—¶æ–‡ä»¶
- âŒ ä¸è¦ä¸Šä¼ åˆ°å…¬å…±ä»£ç ä»“åº“
- âŒ ä¸è¦é€šè¿‡ä¸å®‰å…¨çš„æ¸ é“ä¼ è¾“

### 2. ç”¨æˆ·å¯†ç 

å¯¼å‡ºçš„ç”¨æˆ·æ•°æ®åŒ…å«åŠ å¯†åçš„å¯†ç ï¼š
- âœ… å¯†ç å·²ä½¿ç”¨ bcrypt åŠ å¯†
- âœ… å¯¼å…¥åç”¨æˆ·å¯ä»¥ä½¿ç”¨åŸå¯†ç ç™»å½•
- âš ï¸ å¦‚æœæ˜¯æ¼”ç¤ºç³»ç»Ÿï¼Œå»ºè®®å¯¼å…¥åä¿®æ”¹å¯†ç 

### 3. æ•°æ®è¦†ç›–

å¯¼å…¥æ—¶å¦‚æœé€‰æ‹©"è¦†ç›–ç°æœ‰æ•°æ®"ï¼š
- âš ï¸ ä¼šåˆ é™¤æ–°æœåŠ¡å™¨ä¸Šçš„åŒåé›†åˆ
- âš ï¸ å»ºè®®åœ¨å¯¼å…¥å‰å¤‡ä»½æ–°æœåŠ¡å™¨æ•°æ®
- âœ… å¦‚æœæ˜¯å…¨æ–°éƒ¨ç½²ï¼Œå¯ä»¥å®‰å…¨è¦†ç›–

### 4. æœåŠ¡é‡å¯

å¯¼å…¥é…ç½®æ•°æ®åï¼Œ**å¿…é¡»é‡å¯åç«¯æœåŠ¡**ï¼š
```bash
docker restart tradingagents-backend
```

åŸå› ï¼š
- é…ç½®æ¡¥æ¥æœºåˆ¶éœ€è¦é‡æ–°åŠ è½½é…ç½®
- ç¯å¢ƒå˜é‡éœ€è¦é‡æ–°åŒæ­¥
- ç¼“å­˜éœ€è¦æ¸…ç©º

---

## âœ… éªŒè¯å¯¼å…¥

### 1. æ£€æŸ¥ç³»ç»Ÿé…ç½®

```bash
# è¿æ¥åˆ° MongoDB
docker exec -it tradingagents-mongodb mongo tradingagents \
  -u admin -p tradingagents123 --authenticationDatabase admin

# æ£€æŸ¥ç³»ç»Ÿé…ç½®
db.system_configs.countDocuments()

# æ£€æŸ¥ LLM é…ç½®
var config = db.system_configs.findOne({is_active: true});
if (config && config.llm_configs) {
  print('å¯ç”¨çš„ LLM æ•°é‡: ' + config.llm_configs.filter(c => c.enabled).length);
}
```

### 2. æ£€æŸ¥ç”¨æˆ·æ•°æ®

```bash
# æ£€æŸ¥ç”¨æˆ·æ•°é‡
db.users.countDocuments()

# æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
db.users.find({}, {username: 1, email: 1, role: 1})
```

### 3. æµ‹è¯•ç™»å½•

- ä½¿ç”¨åŸç³»ç»Ÿçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•æ–°ç³»ç»Ÿ
- æ£€æŸ¥æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®

### 4. æµ‹è¯• LLM é…ç½®

- è¿›å…¥"ç³»ç»Ÿé…ç½®"é¡µé¢
- æ£€æŸ¥ LLM é…ç½®æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
- æµ‹è¯• LLM è¿æ¥

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šå¯¼å…¥åé…ç½®ä¸ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é‡å¯åç«¯æœåŠ¡
docker restart tradingagents-backend

# æ£€æŸ¥åç«¯æ—¥å¿—
docker logs tradingagents-backend --tail 100
```

### é—®é¢˜ 2ï¼šå¯¼å…¥å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- MongoDB å®¹å™¨æœªè¿è¡Œ
- æ–‡ä»¶æ ¼å¼é”™è¯¯
- æƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ MongoDB çŠ¶æ€
docker ps | grep mongodb

# æ£€æŸ¥æ–‡ä»¶æ ¼å¼
head -n 20 database_export_config_2025-10-16.json

# æ£€æŸ¥ç”¨æˆ·æƒé™
# ç¡®ä¿ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•
```

### é—®é¢˜ 3ï¼šç”¨æˆ·æ— æ³•ç™»å½•

**å¯èƒ½åŸå› **ï¼š
- å¯†ç åŠ å¯†æ–¹å¼ä¸å…¼å®¹
- ç”¨æˆ·æ•°æ®æœªæ­£ç¡®å¯¼å…¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é‡ç½®ç®¡ç†å‘˜å¯†ç 
docker exec -it tradingagents-mongodb mongo tradingagents \
  -u admin -p tradingagents123 --authenticationDatabase admin \
  --eval "db.users.updateOne({username: 'admin'}, {\$set: {password: '\$2b\$12\$...'}})"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“ç®¡ç†æ–‡æ¡£](./database_management.md)
- [Docker æ•°æ®å·ç®¡ç†](./docker_volumes_unified.md)
- [ç³»ç»Ÿé…ç½®è¯´æ˜](./system_configuration.md)

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸå¯¼å‡ºé…ç½®

å»ºè®®å®šæœŸå¯¼å‡ºé…ç½®æ•°æ®ä½œä¸ºå¤‡ä»½ï¼š
```bash
# æ¯å‘¨å¯¼å‡ºä¸€æ¬¡
# ä¿å­˜åˆ°å®‰å…¨çš„ä½ç½®
```

### 2. ç‰ˆæœ¬æ§åˆ¶

ä¸ºå¯¼å‡ºæ–‡ä»¶æ·»åŠ ç‰ˆæœ¬æ ‡è®°ï¼š
```
database_export_config_v1.0.0_2025-10-16.json
```

### 3. æ–‡æ¡£åŒ–

è®°å½•æ¯æ¬¡å¯¼å‡ºçš„å†…å®¹å’Œç”¨é€”ï¼š
```
å¯¼å‡ºæ—¶é—´: 2025-10-16
å¯¼å‡ºåŸå› : éƒ¨ç½²æ¼”ç¤ºç³»ç»Ÿ
åŒ…å«é…ç½®: 15 ä¸ª LLM æ¨¡å‹
ç›®æ ‡æœåŠ¡å™¨: demo.example.com
```

---

## ğŸ‰ æ€»ç»“

ä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„"é…ç½®æ•°æ®"å¯¼å‡ºåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥ï¼š

âœ… **å¿«é€Ÿéƒ¨ç½²æ¼”ç¤ºç³»ç»Ÿ**
- æ— éœ€é‡æ–°é…ç½® 15 ä¸ª LLM æ¨¡å‹
- ä¿ç•™ç”¨æˆ·è´¦å·å’Œæƒé™
- ä¿ç•™æ‰€æœ‰ç³»ç»Ÿé…ç½®

âœ… **èŠ‚çœæ—¶é—´å’Œç©ºé—´**
- åªå¯¼å‡ºå¿…è¦çš„é…ç½®æ•°æ®
- ä¸åŒ…å«å¤§é‡ä¸šåŠ¡æ•°æ®
- æ–‡ä»¶å°ï¼Œä¼ è¾“å¿«

âœ… **å®‰å…¨å¯é **
- API å¯†é’¥åŠ å¯†ä¼ è¾“
- ç”¨æˆ·å¯†ç å·²åŠ å¯†
- æ”¯æŒæ•°æ®è¦†ç›–å’Œå¢é‡å¯¼å…¥

ç°åœ¨æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªåŒ…å«å®Œæ•´é…ç½®çš„æ¼”ç¤ºç³»ç»Ÿäº†ï¼ğŸš€

