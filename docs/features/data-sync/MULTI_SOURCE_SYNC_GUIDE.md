# å¤šæ•°æ®æºåŒæ­¥ä½¿ç”¨æŒ‡å—

**æ›´æ–°æ—¥æœŸ**: 2025-09-30
**ç‰ˆæœ¬**: v1.3

## ğŸ“Š æ¦‚è¿°

å¤šæ•°æ®æºåŒæ­¥åŠŸèƒ½ä¸ºTradingAgentsé¡¹ç›®æä¾›äº†å¼ºå¤§çš„æ•°æ®æºåˆ†çº§å’Œfallbackæœºåˆ¶ï¼Œç¡®ä¿åœ¨ä¸»æ•°æ®æºä¸å¯ç”¨æ—¶èƒ½å¤Ÿè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æºï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œæ•°æ®è·å–çš„æˆåŠŸç‡ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. æ•°æ®æºåˆ†çº§
- **Tushare** (ä¼˜å…ˆçº§1): ä¸“ä¸šé‡‘èæ•°æ®APIï¼Œæä¾›æœ€å…¨é¢çš„è´¢åŠ¡æŒ‡æ ‡ï¼Œæ”¯æŒæ—¥çº¿/å‘¨çº¿/æœˆçº¿æ•°æ®
- **AKShare** (ä¼˜å…ˆçº§2): å¼€æºé‡‘èæ•°æ®åº“ï¼Œæä¾›åŸºç¡€è‚¡ç¥¨ä¿¡æ¯ï¼Œæ”¯æŒæ—¥çº¿/å‘¨çº¿/æœˆçº¿æ•°æ®
- **BaoStock** (ä¼˜å…ˆçº§3): å…è´¹è¯åˆ¸æ•°æ®å¹³å°ï¼Œæä¾›å†å²æ•°æ®ï¼Œæ”¯æŒæ—¥çº¿/å‘¨çº¿/æœˆçº¿æ•°æ®

### 2. è‡ªåŠ¨Fallbackæœºåˆ¶
- ä¸»æ•°æ®æºå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æº
- æ™ºèƒ½é‡è¯•å’Œé”™è¯¯å¤„ç†
- è¯¦ç»†çš„æ•°æ®æºä½¿ç”¨ç»Ÿè®¡

### 3. çµæ´»é…ç½®
- æ”¯æŒæŒ‡å®šä¼˜å…ˆä½¿ç”¨çš„æ•°æ®æº
- å¯é…ç½®æ•°æ®æºä¼˜å…ˆçº§
- å®æ—¶æ•°æ®æºçŠ¶æ€æ£€æŸ¥
- æ”¯æŒå¤šå‘¨æœŸæ•°æ®åŒæ­¥ï¼ˆæ—¥çº¿ã€å‘¨çº¿ã€æœˆçº¿ï¼‰

## ğŸ› ï¸ é…ç½®æ–¹æ³•

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# Tushareé…ç½®ï¼ˆæ¨èï¼‰
TUSHARE_ENABLED=true
TUSHARE_TOKEN=your_tushare_token_here

# AKShareé…ç½®
AKSHARE_ENABLED=true

# BaoStocké…ç½®
BAOSTOCK_ENABLED=true

# é»˜è®¤æ•°æ®æº
DEFAULT_CHINA_DATA_SOURCE=tushare
```

### æ•°æ®æºä¼˜å…ˆçº§

ç³»ç»Ÿé»˜è®¤æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§ä½¿ç”¨æ•°æ®æºï¼š

1. **Tushare** - æœ€é«˜ä¼˜å…ˆçº§ï¼Œæä¾›æœ€å®Œæ•´çš„æ•°æ®
2. **AKShare** - ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œæä¾›åŸºç¡€æ•°æ®
3. **BaoStock** - æœ€ä½ä¼˜å…ˆçº§ï¼Œä½œä¸ºæœ€åå¤‡ç”¨

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. APIæ¥å£

#### è·å–æ•°æ®æºçŠ¶æ€
```bash
GET /api/sync/multi-source/sources/status
```

å“åº”ç¤ºä¾‹ï¼š
```json
[
  {
    "name": "tushare",
    "priority": 1,
    "available": true,
    "description": "ä¸“ä¸šé‡‘èæ•°æ®APIï¼Œæä¾›é«˜è´¨é‡çš„Aè‚¡æ•°æ®å’Œè´¢åŠ¡æŒ‡æ ‡"
  },
  {
    "name": "akshare",
    "priority": 2,
    "available": true,
    "description": "å¼€æºé‡‘èæ•°æ®åº“ï¼Œæä¾›åŸºç¡€çš„è‚¡ç¥¨ä¿¡æ¯"
  }
]
```

#### è¿è¡Œå¤šæ•°æ®æºåŒæ­¥
```bash
POST /api/sync/multi-source/stock_basics/run
```

å¯é€‰å‚æ•°ï¼š
- `force`: æ˜¯å¦å¼ºåˆ¶è¿è¡Œï¼ˆé»˜è®¤falseï¼‰
- `preferred_sources`: ä¼˜å…ˆä½¿ç”¨çš„æ•°æ®æºï¼Œç”¨é€—å·åˆ†éš”

#### æµ‹è¯•æ•°æ®æºè¿æ¥
```bash
POST /api/sync/multi-source/test-sources
```

#### è·å–åŒæ­¥å»ºè®®
```bash
GET /api/sync/multi-source/recommendations
```

### 2. Pythonä»£ç ä½¿ç”¨

```python
from app.services.multi_source_basics_sync_service import get_multi_source_sync_service
from app.services.data_source_adapters import DataSourceManager

# è·å–æ•°æ®æºç®¡ç†å™¨
manager = DataSourceManager()
available_adapters = manager.get_available_adapters()

# è¿è¡Œå¤šæ•°æ®æºåŒæ­¥
service = get_multi_source_sync_service()
result = await service.run_full_sync(
    force=False,
    preferred_sources=["tushare", "akshare"]
)
```

### 3. å‘½ä»¤è¡Œæµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python scripts/test_multi_source_sync.py
```

## ğŸ“ˆ åŒæ­¥æµç¨‹

### 1. æ•°æ®æºæ£€æŸ¥
- æ£€æµ‹æ‰€æœ‰å¯ç”¨çš„æ•°æ®æº
- æŒ‰ä¼˜å…ˆçº§æ’åº
- è®°å½•æ•°æ®æºçŠ¶æ€

### 2. è‚¡ç¥¨åˆ—è¡¨è·å–
- ä¼˜å…ˆä»Tushareè·å–å®Œæ•´è‚¡ç¥¨åˆ—è¡¨
- å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°AKShareæˆ–BaoStock
- æ ‡å‡†åŒ–æ•°æ®æ ¼å¼

### 3. è´¢åŠ¡æ•°æ®è·å–
- æŸ¥æ‰¾æœ€æ–°äº¤æ˜“æ—¥æœŸ
- è·å–æ¯æ—¥åŸºç¡€è´¢åŠ¡æ•°æ®ï¼ˆPEã€PBã€å¸‚å€¼ç­‰ï¼‰
- ç›®å‰ä¸»è¦ä¾èµ–Tushareçš„daily_basicæ¥å£

### 4. æ•°æ®å¤„ç†å’Œå­˜å‚¨
- ç»Ÿä¸€æ•°æ®æ ¼å¼
- 6ä½è‚¡ç¥¨ä»£ç æ ‡å‡†åŒ–
- æ‰¹é‡æ›´æ–°MongoDB

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ‰€æœ‰æ•°æ®æºéƒ½ä¸å¯ç”¨
**ç—‡çŠ¶**: APIè¿”å›"No available data sources found"

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- ç¡®ä¿è‡³å°‘å®‰è£…äº†ä¸€ä¸ªæ•°æ®æºçš„ä¾èµ–åŒ…
- éªŒè¯Tushare tokenæ˜¯å¦æœ‰æ•ˆ

#### 2. åªæœ‰éƒ¨åˆ†è‚¡ç¥¨æœ‰æ‰©å±•å­—æ®µ
**ç—‡çŠ¶**: PEã€PBç­‰è´¢åŠ¡æŒ‡æ ‡ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿Tushareå¯ç”¨ï¼ˆå…¶ä»–æ•°æ®æºæš‚ä¸æ”¯æŒè´¢åŠ¡æŒ‡æ ‡ï¼‰
- æ£€æŸ¥äº¤æ˜“æ—¥æœŸæ˜¯å¦æ­£ç¡®
- éªŒè¯daily_basicæ•°æ®æ˜¯å¦å¯è·å–

#### 3. åŒæ­¥é€Ÿåº¦æ…¢
**ç—‡çŠ¶**: åŒæ­¥è€—æ—¶è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**:
- ä¼˜å…ˆé…ç½®Tushareï¼ˆæ•°æ®æœ€å…¨é¢ï¼‰
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- è€ƒè™‘å¢åŠ ç¼“å­˜æœºåˆ¶

### è°ƒè¯•æ–¹æ³•

#### 1. æ£€æŸ¥æ•°æ®æºçŠ¶æ€
```bash
curl http://localhost:8000/api/sync/multi-source/sources/status
```

#### 2. æµ‹è¯•æ•°æ®æºè¿æ¥
```bash
curl -X POST http://localhost:8000/api/sync/multi-source/test-sources
```

#### 3. æŸ¥çœ‹åŒæ­¥æ—¥å¿—
æ£€æŸ¥åº”ç”¨æ—¥å¿—ä¸­çš„æ•°æ®æºåˆ‡æ¢ä¿¡æ¯ï¼š
```
INFO: Trying to fetch stock list from TushareAdapter
INFO: Successfully fetched 5427 stocks from TushareAdapter
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®æºé€‰æ‹©ç­–ç•¥
- **ç”Ÿäº§ç¯å¢ƒ**: ä¼˜å…ˆä½¿ç”¨Tushareï¼Œé…ç½®AKShareä½œä¸ºå¤‡ç”¨
- **å¼€å‘ç¯å¢ƒ**: å¯ä»¥ä½¿ç”¨AKShareæˆ–BaoStocké™ä½æˆæœ¬
- **æµ‹è¯•ç¯å¢ƒ**: ä½¿ç”¨ä»»ä½•å¯ç”¨çš„æ•°æ®æº

### 2. ç¼“å­˜ç­–ç•¥
- è‚¡ç¥¨åˆ—è¡¨ç¼“å­˜24å°æ—¶
- è´¢åŠ¡æ•°æ®ç¼“å­˜1å°æ—¶
- å¤±è´¥çš„æ•°æ®æºæš‚æ—¶è·³è¿‡

### 3. å¹¶å‘æ§åˆ¶
- åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªåŒæ­¥ä»»åŠ¡è¿è¡Œ
- ä½¿ç”¨å¼‚æ­¥å¤„ç†é¿å…é˜»å¡
- æ‰¹é‡æ•°æ®åº“æ“ä½œæé«˜æ•ˆç‡

## ğŸ”® æœªæ¥è§„åˆ’

### 1. æ›´å¤šæ•°æ®æºæ”¯æŒ
- ä¸œæ–¹è´¢å¯ŒAPI
- åŒèŠ±é¡ºAPI
- Wind APIï¼ˆä¼ä¸šç‰ˆï¼‰

### 2. æ™ºèƒ½æ•°æ®æºé€‰æ‹©
- åŸºäºæ•°æ®è´¨é‡è‡ªåŠ¨é€‰æ‹©
- æˆæœ¬ä¼˜åŒ–ç®—æ³•
- å®æ—¶æ€§èƒ½ç›‘æ§

### 3. æ•°æ®éªŒè¯å’Œæ¸…æ´—
- è·¨æ•°æ®æºæ•°æ®å¯¹æ¯”
- å¼‚å¸¸æ•°æ®æ£€æµ‹
- è‡ªåŠ¨æ•°æ®ä¿®å¤

## ğŸ“ æœ€ä½³å®è·µ

### 1. é…ç½®å»ºè®®
```bash
# æ¨èé…ç½®
TUSHARE_ENABLED=true
TUSHARE_TOKEN=your_token
AKSHARE_ENABLED=true
BAOSTOCK_ENABLED=true
DEFAULT_CHINA_DATA_SOURCE=tushare
```

### 2. ç›‘æ§å»ºè®®
- å®šæœŸæ£€æŸ¥æ•°æ®æºçŠ¶æ€
- ç›‘æ§åŒæ­¥æˆåŠŸç‡
- è®¾ç½®æ•°æ®è´¨é‡å‘Šè­¦

### 3. ç»´æŠ¤å»ºè®®
- å®šæœŸæ›´æ–°æ•°æ®æºä¾èµ–
- å¤‡ä»½é‡è¦é…ç½®
- æµ‹è¯•æ•…éšœåˆ‡æ¢æœºåˆ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

å¦‚éœ€æ·»åŠ æ–°çš„æ•°æ®æºé€‚é…å™¨ï¼š

1. ç»§æ‰¿`DataSourceAdapter`åŸºç±»
2. å®ç°å¿…è¦çš„æŠ½è±¡æ–¹æ³•
3. åœ¨`DataSourceManager`ä¸­æ³¨å†Œ
4. æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
5. æ›´æ–°æ–‡æ¡£

---

## ğŸ¯ é€‰æ‹©æ€§æ•°æ®åŒæ­¥

### åŠŸèƒ½è¯´æ˜

é€‰æ‹©æ€§æ•°æ®åŒæ­¥åŠŸèƒ½å…è®¸æ‚¨åªæ›´æ–°ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œé€‚ç”¨äºå¢é‡æ›´æ–°å’Œæ•°æ®ä¿®å¤åœºæ™¯ã€‚

### æ”¯æŒçš„æ•°æ®ç±»å‹

- `basic_info` - è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
- `historical` - å†å²è¡Œæƒ…ï¼ˆæ—¥çº¿ï¼‰
- `weekly` - å‘¨çº¿æ•°æ®
- `monthly` - æœˆçº¿æ•°æ®
- `financial` - è´¢åŠ¡æ•°æ®
- `quotes` - æœ€æ–°è¡Œæƒ…

### ä½¿ç”¨ç¤ºä¾‹

```bash
# ä»…æ›´æ–°å†å²æ•°æ®
python cli/tushare_init.py --full --sync-items historical --historical-days 30

# ä»…æ›´æ–°è´¢åŠ¡æ•°æ®
python cli/tushare_init.py --full --sync-items financial

# åŒæ­¥å¤šä¸ªæ•°æ®ç±»å‹
python cli/tushare_init.py --full --sync-items historical,financial,quotes
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[Tushareæ•°æ®åˆå§‹åŒ–æŒ‡å—](guides/tushare_unified/data_initialization_guide.md#é€‰æ‹©æ€§æ•°æ®åŒæ­¥)

## ğŸŒ å…¨å†å²æ•°æ®åŒæ­¥

### åŠŸèƒ½è¯´æ˜

å…¨å†å²æ•°æ®åŒæ­¥åŠŸèƒ½å…è®¸è·å–è‚¡ç¥¨ä»1990å¹´è‡³ä»Šçš„å®Œæ•´å†å²æ•°æ®ï¼Œé€‚ç”¨äºé•¿æœŸå›æµ‹å’Œç ”ç©¶ã€‚

### é˜ˆå€¼æœºåˆ¶

å½“ `--historical-days >= 3650`ï¼ˆ10å¹´ï¼‰æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢åˆ°å…¨å†å²æ¨¡å¼ï¼š

| historical_days | åŒæ­¥èŒƒå›´ | è¯´æ˜ |
|----------------|---------|------|
| < 3650 | æŒ‡å®šå¤©æ•° | ä»å½“å‰æ—¥æœŸå¾€å‰æ¨ç®—æŒ‡å®šå¤©æ•° |
| >= 3650 | å…¨å†å² | ä»1990-01-01è‡³ä»Šçš„æ‰€æœ‰æ•°æ® |

### ä½¿ç”¨ç¤ºä¾‹

```bash
# Tushareå…¨å†å²åˆå§‹åŒ–
python cli/tushare_init.py --full --historical-days 10000

# AKShareå…¨å†å²åˆå§‹åŒ–
python cli/akshare_init.py --full --historical-days 10000

# BaoStockå…¨å†å²åˆå§‹åŒ–
python cli/baostock_init.py --full --historical-days 10000

# å…¨å†å²å¤šå‘¨æœŸåˆå§‹åŒ–ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
python cli/tushare_init.py --full --multi-period --historical-days 10000
```

### æ•°æ®é‡å¯¹æ¯”

| åŒæ­¥æ¨¡å¼ | æ—¥çº¿è®°å½•æ•° | å­˜å‚¨ç©ºé—´ | åŒæ­¥è€—æ—¶ |
|---------|-----------|---------|---------|
| é»˜è®¤1å¹´ | ~1,250,000æ¡ | ~500MB | 30-60åˆ†é’Ÿ |
| å…¨å†å² | ~8,000,000æ¡ | 2-5GB | 2-4å°æ—¶ |

### é€‚ç”¨åœºæ™¯

- âœ… **ç”Ÿäº§ç¯å¢ƒé¦–æ¬¡éƒ¨ç½²** - è·å–å®Œæ•´å†å²æ•°æ®
- âœ… **é•¿æœŸå›æµ‹ç ”ç©¶** - éœ€è¦å¤šå¹´å†å²æ•°æ®
- âœ… **æ•°æ®è¡¥å…¨** - è¡¥å……ç¼ºå¤±çš„å†å²æ•°æ®

### æ³¨æ„äº‹é¡¹

1. **è€—æ—¶è¾ƒé•¿**: å…¨å†å²åŒæ­¥éœ€è¦2-4å°æ—¶ï¼Œå»ºè®®éäº¤æ˜“æ—¶é—´è¿›è¡Œ
2. **APIé™æµ**: æ³¨æ„å„æ•°æ®æºçš„è°ƒç”¨é¢‘ç‡é™åˆ¶
3. **å­˜å‚¨ç©ºé—´**: ç¡®ä¿æœ‰2-5GBå¯ç”¨ç£ç›˜ç©ºé—´
4. **æ¨èç­–ç•¥**: é¦–æ¬¡å…¨å†å²åˆå§‹åŒ–ï¼Œæ—¥å¸¸å¢é‡æ›´æ–°

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[Tushareæ•°æ®åˆå§‹åŒ–æŒ‡å—](guides/tushare_unified/data_initialization_guide.md#å…¨å†å²æ•°æ®åŒæ­¥)

## ğŸ“Š å¤šå‘¨æœŸæ•°æ®æ”¯æŒ

### æ”¯æŒçš„æ•°æ®å‘¨æœŸ

æ‰€æœ‰ä¸‰ä¸ªæ•°æ®æºï¼ˆTushareã€AKShareã€BaoStockï¼‰éƒ½æ”¯æŒå¤šå‘¨æœŸå†å²æ•°æ®ï¼š

1. **æ—¥çº¿æ•°æ®** (daily) - æ¯ä¸ªäº¤æ˜“æ—¥çš„OHLCVæ•°æ®
2. **å‘¨çº¿æ•°æ®** (weekly) - æ¯å‘¨çš„OHLCVæ•°æ®
3. **æœˆçº¿æ•°æ®** (monthly) - æ¯æœˆçš„OHLCVæ•°æ®

### æ•°æ®å­˜å‚¨

æ‰€æœ‰å‘¨æœŸçš„æ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨ `stock_daily_quotes` é›†åˆä¸­ï¼Œé€šè¿‡ `period` å­—æ®µåŒºåˆ†ï¼š
- `period: "daily"` - æ—¥çº¿æ•°æ®
- `period: "weekly"` - å‘¨çº¿æ•°æ®
- `period: "monthly"` - æœˆçº¿æ•°æ®

### åˆå§‹åŒ–å¤šå‘¨æœŸæ•°æ®

```bash
# Tushareå¤šå‘¨æœŸåˆå§‹åŒ–ï¼ˆé»˜è®¤1å¹´ï¼‰
python cli/tushare_init.py --full --multi-period

# æŒ‡å®šå†å²æ•°æ®èŒƒå›´ï¼ˆ6ä¸ªæœˆï¼‰
python cli/tushare_init.py --full --multi-period --historical-days 180

# å…¨å†å²å¤šå‘¨æœŸåˆå§‹åŒ–ï¼ˆä»1990å¹´è‡³ä»Šï¼Œæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
python cli/tushare_init.py --full --multi-period --historical-days 10000
```

### æŸ¥è¯¢å¤šå‘¨æœŸæ•°æ®

```python
from tradingagents.config.database_manager import get_mongodb_client

client = get_mongodb_client()
db = client.get_database('tradingagents')
collection = db.stock_daily_quotes

# æŸ¥è¯¢æ—¥çº¿æ•°æ®
daily_data = list(collection.find({
    'symbol': '000001',
    'period': 'daily',
    'data_source': 'tushare'
}))

# æŸ¥è¯¢å‘¨çº¿æ•°æ®
weekly_data = list(collection.find({
    'symbol': '000001',
    'period': 'weekly',
    'data_source': 'tushare'
}))

# æŸ¥è¯¢æœˆçº¿æ•°æ®
monthly_data = list(collection.find({
    'symbol': '000001',
    'period': 'monthly',
    'data_source': 'tushare'
}))
```

---

**æ³¨æ„**: å¤šæ•°æ®æºåŒæ­¥åŠŸèƒ½éœ€è¦è‡³å°‘é…ç½®ä¸€ä¸ªå¯ç”¨çš„æ•°æ®æºã€‚æ¨èä½¿ç”¨Tushareä½œä¸ºä¸»æ•°æ®æºä»¥è·å¾—æœ€å®Œæ•´çš„è´¢åŠ¡æ•°æ®ã€‚

**æ›´æ–°æ—¥æœŸ**: 2025-09-30
**ç‰ˆæœ¬**: v1.2 - æ–°å¢é€‰æ‹©æ€§æ•°æ®åŒæ­¥å’Œå¤šå‘¨æœŸæ•°æ®æ”¯æŒ
