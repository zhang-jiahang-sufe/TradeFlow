# å¦‚ä½•è®¿é—®ä½¿ç”¨ç»Ÿè®¡é¡µé¢

## ğŸ¯ å¿«é€Ÿè®¿é—®

### æ–¹å¼ 1ï¼šé€šè¿‡å¯¼èˆªèœå•ï¼ˆæ¨èï¼‰

1. **ç™»å½•ç³»ç»Ÿ**
   - è®¿é—® `http://localhost:3001`ï¼ˆæˆ–æ‚¨çš„å‰ç«¯åœ°å€ï¼‰
   - ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•

2. **è¿›å…¥è®¾ç½®é¡µé¢**
   - ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„ **"è®¾ç½®"** å›¾æ ‡

3. **é€‰æ‹©ç³»ç»Ÿé…ç½®**
   - åœ¨è®¾ç½®é¡µé¢é¡¶éƒ¨ï¼Œç¡®è®¤å½“å‰åœ¨ **"ç³»ç»Ÿé…ç½®"** æ ‡ç­¾
   - å¦‚æœä¸åœ¨ï¼Œç‚¹å‡»åˆ‡æ¢åˆ°"ç³»ç»Ÿé…ç½®"

4. **ç‚¹å‡»ä½¿ç”¨ç»Ÿè®¡**
   - åœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ° **"ä½¿ç”¨ç»Ÿè®¡"** èœå•é¡¹ï¼ˆå¸¦æœ‰ ğŸ“Š å›¾æ ‡ï¼‰
   - ç‚¹å‡»è¯¥èœå•é¡¹

5. **æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡**
   - ç‚¹å‡» **"æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡"** æŒ‰é’®
   - é¡µé¢ä¼šè·³è½¬åˆ°ä½¿ç”¨ç»Ÿè®¡ç•Œé¢

### æ–¹å¼ 2ï¼šç›´æ¥è®¿é—® URL

ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š

```
http://localhost:3001/settings/usage
```

æŒ‰å›è½¦å³å¯ç›´æ¥è®¿é—®ä½¿ç”¨ç»Ÿè®¡é¡µé¢ã€‚

## ğŸ“Š é¡µé¢åŠŸèƒ½

è®¿é—®æˆåŠŸåï¼Œæ‚¨å°†çœ‹åˆ°ï¼š

### 1. ç»Ÿè®¡æ¦‚è§ˆï¼ˆé¡¶éƒ¨ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»è¯·æ±‚æ•°     â”‚ æ€»è¾“å…¥Token â”‚ æ€»è¾“å‡ºToken â”‚ æ€»æˆæœ¬      â”‚
â”‚ ğŸ“„ 0        â”‚ â¬†ï¸ 0        â”‚ â¬‡ï¸ 0        â”‚ ğŸ’° Â¥0.00   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ï¼ˆå³ä¸Šè§’ï¼‰
- æœ€è¿‘ 7 å¤©
- æœ€è¿‘ 30 å¤©
- æœ€è¿‘ 90 å¤©

### 3. å›¾è¡¨å±•ç¤ºï¼ˆä¸­é—´ï¼‰
- **æŒ‰ä¾›åº”å•†ç»Ÿè®¡**ï¼ˆé¥¼å›¾ï¼‰
- **æŒ‰æ¨¡å‹ç»Ÿè®¡**ï¼ˆæŸ±çŠ¶å›¾ï¼‰
- **æ¯æ—¥æˆæœ¬è¶‹åŠ¿**ï¼ˆæŠ˜çº¿å›¾ï¼‰

### 4. ä½¿ç”¨è®°å½•è¡¨æ ¼ï¼ˆåº•éƒ¨ï¼‰
- è¯¦ç»†çš„ API è°ƒç”¨è®°å½•
- æ”¯æŒåˆ†é¡µæŸ¥çœ‹

### 5. æ“ä½œæŒ‰é’®
- **åˆ·æ–°** - é‡æ–°åŠ è½½æ•°æ®
- **æ¸…ç†æ—§è®°å½•** - åˆ é™¤ 90 å¤©å‰çš„æ•°æ®

## ğŸ”§ é…ç½®æ¨¡å‹å®šä»·

åœ¨æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡ä¹‹å‰ï¼Œå»ºè®®å…ˆé…ç½®æ¨¡å‹å®šä»·ï¼š

1. **è®¿é—®é…ç½®ç®¡ç†**
   ```
   è®¾ç½® > ç³»ç»Ÿé…ç½® > é…ç½®ç®¡ç†
   ```

2. **é€‰æ‹©å¤§æ¨¡å‹é…ç½®**
   - ç‚¹å‡»"å¤§æ¨¡å‹é…ç½®"æ ‡ç­¾

3. **ç¼–è¾‘æ¨¡å‹**
   - æ‰¾åˆ°è¦é…ç½®çš„æ¨¡å‹ï¼ˆå¦‚ qwen-maxï¼‰
   - ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®

4. **å¡«å†™å®šä»·ä¿¡æ¯**
   - æ»šåŠ¨åˆ°"å®šä»·é…ç½®"éƒ¨åˆ†
   - å¡«å†™ï¼š
     - **è¾“å…¥ä»·æ ¼**: æ¯ 1000 ä¸ªè¾“å…¥ token çš„ä»·æ ¼ï¼ˆå¦‚ 0.0200ï¼‰
     - **è¾“å‡ºä»·æ ¼**: æ¯ 1000 ä¸ªè¾“å‡º token çš„ä»·æ ¼ï¼ˆå¦‚ 0.0600ï¼‰
     - **è´§å¸å•ä½**: é€‰æ‹© CNYï¼ˆäººæ°‘å¸ï¼‰

5. **ä¿å­˜é…ç½®**
   - ç‚¹å‡»"ä¿å­˜"æŒ‰é’®

6. **æŸ¥çœ‹å®šä»·**
   - ä¿å­˜åï¼Œæ¨¡å‹å¡ç‰‡ä¼šæ˜¾ç¤ºå®šä»·ä¿¡æ¯ï¼š
     ```
     ğŸ’° å®šä»·:
       è¾“å…¥: 0.0200 CNY/1K
       è¾“å‡º: 0.0600 CNY/1K
     ```

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: çœ‹ä¸åˆ°"ä½¿ç”¨ç»Ÿè®¡"èœå•é¡¹ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤æ‚¨åœ¨"ç³»ç»Ÿé…ç½®"æ ‡ç­¾ï¼Œè€Œä¸æ˜¯"ä¸ªäººè®¾ç½®"æˆ–"ç³»ç»Ÿç®¡ç†"
2. åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ˆCtrl+F5 æˆ– Cmd+Shift+Rï¼‰
3. æ£€æŸ¥å‰ç«¯æ˜¯å¦æ­£åœ¨è¿è¡Œï¼ˆåº”è¯¥åœ¨ http://localhost:3001ï¼‰

### Q2: ç‚¹å‡»"ä½¿ç”¨ç»Ÿè®¡"åæ²¡æœ‰ååº”ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹ Console æ ‡ç­¾æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. å°è¯•ç›´æ¥è®¿é—® URLï¼š`http://localhost:3001/settings/usage`

### Q3: é¡µé¢æ˜¾ç¤º"æš‚æ— æ•°æ®"ï¼Ÿ

**åŸå› **ï¼šè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿˜æ²¡æœ‰ä½¿ç”¨è®°å½•ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. è¿è¡Œä¸€äº›è‚¡ç¥¨åˆ†æï¼Œç”Ÿæˆä½¿ç”¨è®°å½•
2. æˆ–è€…ä½¿ç”¨æµ‹è¯•è„šæœ¬ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼ˆè§ä¸‹æ–‡ï¼‰

### Q4: å›¾è¡¨ä¸æ˜¾ç¤ºï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ˜¯å¦æœ‰ä½¿ç”¨æ•°æ®
2. å°è¯•åˆ‡æ¢æ—¶é—´èŒƒå›´
3. ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®
4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### Q5: æˆæœ¬æ˜¾ç¤ºä¸º 0ï¼Ÿ

**åŸå› **ï¼šæ¨¡å‹å®šä»·æœªé…ç½®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. è®¿é—®"é…ç½®ç®¡ç† > å¤§æ¨¡å‹é…ç½®"
2. ä¸ºæ¯ä¸ªæ¨¡å‹é…ç½®å®šä»·ä¿¡æ¯
3. è¿”å›ä½¿ç”¨ç»Ÿè®¡é¡µé¢åˆ·æ–°

## ğŸ§ª ç”Ÿæˆæµ‹è¯•æ•°æ®

å¦‚æœæƒ³æµ‹è¯•ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½ï¼Œå¯ä»¥ï¼š

### æ–¹æ³• 1ï¼šè¿è¡Œè‚¡ç¥¨åˆ†æ

1. è®¿é—®"è‚¡ç¥¨åˆ†æ > å•è‚¡åˆ†æ"
2. è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ 600519ï¼‰
3. ç‚¹å‡»"å¼€å§‹åˆ†æ"
4. ç­‰å¾…åˆ†æå®Œæˆ
5. è¿”å›ä½¿ç”¨ç»Ÿè®¡é¡µé¢æŸ¥çœ‹æ•°æ®

### æ–¹æ³• 2ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

åˆ›å»ºæµ‹è¯•è„šæœ¬ `scripts/add_test_usage_data.py`ï¼š

```python
import asyncio
from datetime import datetime, timedelta
import random
from app.services.usage_statistics_service import usage_statistics_service
from app.models.config import UsageRecord

async def add_test_data():
    """æ·»åŠ æµ‹è¯•ä½¿ç”¨æ•°æ®"""
    providers = ['dashscope', 'openai', 'google']
    models = {
        'dashscope': ['qwen-max', 'qwen-plus', 'qwen-turbo'],
        'openai': ['gpt-4', 'gpt-3.5-turbo'],
        'google': ['gemini-pro']
    }
    
    # ç”Ÿæˆæœ€è¿‘ 30 å¤©çš„æ•°æ®
    for i in range(30):
        date = datetime.now() - timedelta(days=i)
        
        # æ¯å¤©ç”Ÿæˆ 5-10 æ¡è®°å½•
        for _ in range(random.randint(5, 10)):
            provider = random.choice(providers)
            model = random.choice(models[provider])
            
            input_tokens = random.randint(500, 3000)
            output_tokens = random.randint(200, 1500)
            
            # å‡è®¾ä»·æ ¼
            input_price = 0.02
            output_price = 0.06
            cost = (input_tokens / 1000) * input_price + (output_tokens / 1000) * output_price
            
            record = UsageRecord(
                timestamp=date.isoformat(),
                provider=provider,
                model_name=model,
                input_tokens=input_tokens,
                output_tokens=output_tokens,
                cost=cost,
                session_id=f"test_session_{i}_{_}",
                analysis_type="stock_analysis"
            )
            
            await usage_statistics_service.add_usage_record(record)
    
    print("âœ… æµ‹è¯•æ•°æ®æ·»åŠ å®Œæˆï¼")

if __name__ == "__main__":
    asyncio.run(add_test_data())
```

è¿è¡Œè„šæœ¬ï¼š
```powershell
.\.venv\Scripts\python scripts/add_test_usage_data.py
```

## ğŸ” éªŒè¯è®¿é—®

### æ£€æŸ¥æ¸…å•

- [ ] åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆhttp://localhost:8000ï¼‰
- [ ] å‰ç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆhttp://localhost:3001ï¼‰
- [ ] å·²ç™»å½•ç³»ç»Ÿ
- [ ] åœ¨"ç³»ç»Ÿé…ç½®"æ ‡ç­¾ä¸‹
- [ ] å¯ä»¥çœ‹åˆ°"ä½¿ç”¨ç»Ÿè®¡"èœå•é¡¹
- [ ] ç‚¹å‡»åå¯ä»¥è·³è½¬åˆ°ä½¿ç”¨ç»Ÿè®¡é¡µé¢

### åç«¯ API éªŒè¯

è®¿é—® Swagger æ–‡æ¡£ï¼š
```
http://localhost:8000/docs
```

æ‰¾åˆ°"ä½¿ç”¨ç»Ÿè®¡"æ ‡ç­¾ï¼Œåº”è¯¥çœ‹åˆ°ä»¥ä¸‹ APIï¼š
- GET `/api/usage/records` - è·å–ä½¿ç”¨è®°å½•
- GET `/api/usage/statistics` - è·å–ä½¿ç”¨ç»Ÿè®¡
- GET `/api/usage/cost/by-provider` - æŒ‰ä¾›åº”å•†ç»Ÿè®¡
- GET `/api/usage/cost/by-model` - æŒ‰æ¨¡å‹ç»Ÿè®¡
- GET `/api/usage/cost/daily` - æ¯æ—¥æˆæœ¬ç»Ÿè®¡
- DELETE `/api/usage/records/old` - åˆ é™¤æ—§è®°å½•

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœä»ç„¶æ— æ³•è®¿é—®ä½¿ç”¨ç»Ÿè®¡é¡µé¢ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆF12ï¼‰
   - æŸ¥çœ‹æ˜¯å¦æœ‰ JavaScript é”™è¯¯
   - æŸ¥çœ‹ Network æ ‡ç­¾ï¼Œæ£€æŸ¥ API è¯·æ±‚æ˜¯å¦æˆåŠŸ

2. **åç«¯æ—¥å¿—**
   - æŸ¥çœ‹ç»ˆç«¯è¾“å‡º
   - æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

3. **å‰ç«¯æ—¥å¿—**
   - æŸ¥çœ‹ Vite å¼€å‘æœåŠ¡å™¨è¾“å‡º
   - æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯

4. **è·¯ç”±é…ç½®**
   - ç¡®è®¤ `frontend/src/router/index.ts` ä¸­æœ‰ `/settings/usage` è·¯ç”±
   - ç¡®è®¤ `frontend/src/views/Settings/index.vue` ä¸­æœ‰ä½¿ç”¨ç»Ÿè®¡èœå•é¡¹

## ğŸ‰ æˆåŠŸè®¿é—®

å¦‚æœæ‚¨èƒ½çœ‹åˆ°ä½¿ç”¨ç»Ÿè®¡é¡µé¢ï¼Œæ­å–œï¼æ‚¨å·²ç»æˆåŠŸè®¿é—®äº†ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½ã€‚

ç°åœ¨æ‚¨å¯ä»¥ï¼š
- ğŸ“Š æŸ¥çœ‹æ¨¡å‹ä½¿ç”¨æƒ…å†µ
- ğŸ’° ç›‘æ§æˆæœ¬æ”¯å‡º
- ğŸ“ˆ åˆ†æä½¿ç”¨è¶‹åŠ¿
- ğŸ§¹ ç®¡ç†å†å²æ•°æ®

äº«å—ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½å§ï¼

