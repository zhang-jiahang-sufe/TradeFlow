# æç¤ºè¯æ¨¡ç‰ˆç³»ç»Ÿ - æ¶æ„å›¾

## ğŸ—ï¸ ç³»ç»Ÿæ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚ (Frontend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ æ¨¡ç‰ˆé€‰æ‹©ç»„ä»¶  â”‚  â”‚ æ¨¡ç‰ˆç¼–è¾‘å™¨   â”‚  â”‚ æ¨¡ç‰ˆé¢„è§ˆ     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APIå±‚ (Backend)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  GET /api/prompts/templates/{analyst_type}              â”‚   â”‚
â”‚  â”‚  GET /api/prompts/templates/{analyst_type}/{name}       â”‚   â”‚
â”‚  â”‚  POST /api/prompts/templates/{analyst_type}             â”‚   â”‚
â”‚  â”‚  PUT /api/prompts/templates/{analyst_type}/{name}       â”‚   â”‚
â”‚  â”‚  DELETE /api/prompts/templates/{analyst_type}/{name}    â”‚   â”‚
â”‚  â”‚  POST /api/prompts/templates/{analyst_type}/{name}/previewâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¨¡ç‰ˆç®¡ç†å±‚ (Manager)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         PromptTemplateManager                            â”‚   â”‚
â”‚  â”‚  â”œâ”€ load_template()                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ list_templates()                                     â”‚   â”‚
â”‚  â”‚  â”œâ”€ save_custom_template()                               â”‚   â”‚
â”‚  â”‚  â”œâ”€ validate_template()                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ render_template()                                    â”‚   â”‚
â”‚  â”‚  â””â”€ get_template_versions()                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åˆ†æå¸ˆé›†æˆå±‚ (Analysts)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ åŸºæœ¬é¢åˆ†æå¸ˆ  â”‚  â”‚ å¸‚åœºåˆ†æå¸ˆ   â”‚  â”‚ æ–°é—»åˆ†æå¸ˆ   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚ ç¤¾åª’åˆ†æå¸ˆ   â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å­˜å‚¨å±‚ (Storage)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ–‡ä»¶ç³»ç»Ÿ (YAML)          æ•°æ®åº“ (å¯é€‰)                  â”‚   â”‚
â”‚  â”‚  prompts/templates/       PromptTemplateDB               â”‚   â”‚
â”‚  â”‚  â”œâ”€ fundamentals/         (è‡ªå®šä¹‰æ¨¡ç‰ˆ)                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ market/                                              â”‚   â”‚
â”‚  â”‚  â”œâ”€ news/                                                â”‚   â”‚
â”‚  â”‚  â””â”€ social/                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®æµå›¾

### 1. åŠ è½½æ¨¡ç‰ˆæµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆ
    â†“
API: GET /api/prompts/templates/{analyst_type}/{name}
    â†“
PromptTemplateManager.load_template()
    â†“
æ£€æŸ¥ç¼“å­˜ â”€â†’ å‘½ä¸­ â”€â†’ è¿”å›ç¼“å­˜
    â†“
    æœªå‘½ä¸­
    â†“
è¯»å–YAMLæ–‡ä»¶
    â†“
éªŒè¯æ¨¡ç‰ˆæ ¼å¼
    â†“
ç¼“å­˜æ¨¡ç‰ˆ
    â†“
è¿”å›æ¨¡ç‰ˆ
```

### 2. æ‰§è¡Œåˆ†ææµç¨‹

```
ç”¨æˆ·å‘èµ·åˆ†æ
    â†“
API: POST /api/analysis
    {
      "ticker": "000001",
      "analyst_templates": {
        "fundamentals": "conservative"
      }
    }
    â†“
åŠ è½½é€‰å®šçš„æ¨¡ç‰ˆ
    â†“
åˆ›å»ºåˆ†æå¸ˆå®ä¾‹
    (template_name="conservative")
    â†“
åˆ†æå¸ˆèŠ‚ç‚¹æ‰§è¡Œ
    â”œâ”€ åŠ è½½æ¨¡ç‰ˆ
    â”œâ”€ æ¸²æŸ“å˜é‡
    â”œâ”€ ç»„åˆæç¤ºè¯
    â””â”€ è°ƒç”¨LLM
    â†“
è¿”å›åˆ†æç»“æœ
```

### 3. åˆ›å»ºè‡ªå®šä¹‰æ¨¡ç‰ˆæµç¨‹

```
ç”¨æˆ·ç¼–è¾‘æ¨¡ç‰ˆ
    â†“
API: POST /api/prompts/templates/{analyst_type}
    {
      "name": "æˆ‘çš„æ¨¡ç‰ˆ",
      "system_prompt": "...",
      ...
    }
    â†“
éªŒè¯æ¨¡ç‰ˆæ ¼å¼
    â†“
ä¿å­˜åˆ°æ•°æ®åº“
    â†“
è¿”å›æ¨¡ç‰ˆID
    â†“
ç”¨æˆ·å¯é€‰æ‹©ä½¿ç”¨
```

## ğŸ”„ æ¨¡ç‰ˆæ¸²æŸ“æµç¨‹

```
åŸå§‹æ¨¡ç‰ˆ (YAML)
    â†“
    system_prompt: "åˆ†æ {ticker} ({company_name})"
    â†“
PromptTemplateManager.render_template()
    â†“
    variables = {
      "ticker": "000001",
      "company_name": "å¹³å®‰é“¶è¡Œ"
    }
    â†“
æ¸²æŸ“åçš„æ¨¡ç‰ˆ
    â†“
    system_prompt: "åˆ†æ 000001 (å¹³å®‰é“¶è¡Œ)"
    â†“
æ³¨å…¥åˆ°åˆ†æå¸ˆæç¤ºè¯
```

## ğŸ“ æ¨¡ç‰ˆæ–‡ä»¶ç»“æ„

```
prompts/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ fundamentals/
â”‚   â”‚   â”œâ”€â”€ default.yaml
â”‚   â”‚   â”‚   â”œâ”€ version: "1.0"
â”‚   â”‚   â”‚   â”œâ”€ analyst_type: "fundamentals"
â”‚   â”‚   â”‚   â”œâ”€ name: "åŸºæœ¬é¢åˆ†æ - é»˜è®¤æ¨¡ç‰ˆ"
â”‚   â”‚   â”‚   â”œâ”€ system_prompt: "..."
â”‚   â”‚   â”‚   â”œâ”€ tool_guidance: "..."
â”‚   â”‚   â”‚   â”œâ”€ analysis_requirements: "..."
â”‚   â”‚   â”‚   â”œâ”€ output_format: "..."
â”‚   â”‚   â”‚   â””â”€ constraints: {...}
â”‚   â”‚   â”œâ”€â”€ conservative.yaml
â”‚   â”‚   â””â”€â”€ aggressive.yaml
â”‚   â”œâ”€â”€ market/
â”‚   â”‚   â”œâ”€â”€ default.yaml
â”‚   â”‚   â”œâ”€â”€ short_term.yaml
â”‚   â”‚   â””â”€â”€ long_term.yaml
â”‚   â”œâ”€â”€ news/
â”‚   â”‚   â”œâ”€â”€ default.yaml
â”‚   â”‚   â”œâ”€â”€ real_time.yaml
â”‚   â”‚   â””â”€â”€ deep.yaml
â”‚   â””â”€â”€ social/
â”‚       â”œâ”€â”€ default.yaml
â”‚       â”œâ”€â”€ sentiment_focus.yaml
â”‚       â””â”€â”€ trend_focus.yaml
â”œâ”€â”€ schema/
â”‚   â””â”€â”€ prompt_template_schema.json
â””â”€â”€ README.md
```

## ğŸ”Œ åˆ†æå¸ˆé›†æˆæ¶æ„

```
create_fundamentals_analyst(llm, toolkit, template_name="default")
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PromptTemplateManager                â”‚
    â”‚ .load_template("fundamentals",       â”‚
    â”‚                "default")            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    template = {
      "system_prompt": "...",
      "tool_guidance": "...",
      ...
    }
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ fundamentals_analyst_node()          â”‚
    â”‚ â”œâ”€ æ¸²æŸ“æ¨¡ç‰ˆå˜é‡                      â”‚
    â”‚ â”œâ”€ ç»„åˆæç¤ºè¯                        â”‚
    â”‚ â”œâ”€ åˆ›å»ºChatPromptTemplate            â”‚
    â”‚ â”œâ”€ è°ƒç”¨LLM                           â”‚
    â”‚ â””â”€ è¿”å›åˆ†æç»“æœ                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ APIç«¯ç‚¹æ¶æ„

```
/api/prompts/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ {analyst_type}
â”‚   â”‚   â”œâ”€â”€ GET      â†’ åˆ—å‡ºæ‰€æœ‰æ¨¡ç‰ˆ
â”‚   â”‚   â”œâ”€â”€ POST     â†’ åˆ›å»ºæ–°æ¨¡ç‰ˆ
â”‚   â”‚   â””â”€â”€ {name}
â”‚   â”‚       â”œâ”€â”€ GET      â†’ è·å–æ¨¡ç‰ˆè¯¦æƒ…
â”‚   â”‚       â”œâ”€â”€ PUT      â†’ æ›´æ–°æ¨¡ç‰ˆ
â”‚   â”‚       â”œâ”€â”€ DELETE   â†’ åˆ é™¤æ¨¡ç‰ˆ
â”‚   â”‚       â”œâ”€â”€ preview
â”‚   â”‚       â”‚   â””â”€â”€ POST â†’ é¢„è§ˆæ¨¡ç‰ˆ
â”‚   â”‚       â””â”€â”€ versions
â”‚   â”‚           â””â”€â”€ GET  â†’ è·å–ç‰ˆæœ¬å†å²
```

## ğŸ’¾ ç¼“å­˜ç­–ç•¥

```
PromptTemplateManager
    â†“
    cache = {
      "fundamentals:default": {...},
      "fundamentals:conservative": {...},
      "market:short_term": {...},
      ...
    }
    â†“
    åŠ è½½æ¨¡ç‰ˆæ—¶ï¼š
    1. æ£€æŸ¥ç¼“å­˜
    2. å¦‚æœå­˜åœ¨ï¼Œè¿”å›ç¼“å­˜
    3. å¦‚æœä¸å­˜åœ¨ï¼Œè¯»å–æ–‡ä»¶
    4. éªŒè¯æ ¼å¼
    5. å­˜å…¥ç¼“å­˜
    6. è¿”å›æ¨¡ç‰ˆ
```

## ğŸ” ç‰ˆæœ¬ç®¡ç†æ¶æ„

```
prompts/
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ fundamentals/
â”‚       â””â”€â”€ default.yaml (å½“å‰ç‰ˆæœ¬)
â””â”€â”€ .versions/
    â”œâ”€â”€ fundamentals_default_v1.0.yaml
    â”œâ”€â”€ fundamentals_default_v1.1.yaml
    â””â”€â”€ fundamentals_default_v1.2.yaml
    
ç‰ˆæœ¬æ“ä½œï¼š
â”œâ”€ get_versions() â†’ åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬
â”œâ”€ load_version(version="1.0") â†’ åŠ è½½ç‰¹å®šç‰ˆæœ¬
â””â”€ rollback(target_version="1.0") â†’ å›æ»šåˆ°ç‰ˆæœ¬
```

## ğŸ“Š æ¨¡ç‰ˆé€‰æ‹©æµç¨‹

```
ç”¨æˆ·ç•Œé¢
    â†“
é€‰æ‹©åˆ†æå¸ˆ
    â†“
è·å–è¯¥åˆ†æå¸ˆçš„æ‰€æœ‰æ¨¡ç‰ˆ
    GET /api/prompts/templates/{analyst_type}
    â†“
æ˜¾ç¤ºæ¨¡ç‰ˆåˆ—è¡¨
    â”œâ”€ é»˜è®¤æ¨¡ç‰ˆ (æ¨è)
    â”œâ”€ ä¿å®ˆæ¨¡ç‰ˆ
    â”œâ”€ æ¿€è¿›æ¨¡ç‰ˆ
    â””â”€ è‡ªå®šä¹‰æ¨¡ç‰ˆ
    â†“
ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆ
    â†“
é¢„è§ˆæ¨¡ç‰ˆ (å¯é€‰)
    POST /api/prompts/templates/{analyst_type}/{name}/preview
    â†“
ç¡®è®¤é€‰æ‹©
    â†“
å‘èµ·åˆ†æ
    POST /api/analysis
    {
      "analyst_templates": {
        "fundamentals": "conservative"
      }
    }
```

