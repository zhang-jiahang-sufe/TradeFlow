# è‚¡ç¥¨ä»£ç æ ¼å¼éªŒè¯åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

åœ¨å•è‚¡åˆ†æé¡µé¢æ·»åŠ äº†å‰ç«¯è‚¡ç¥¨ä»£ç æ ¼å¼éªŒè¯åŠŸèƒ½ï¼Œæ”¯æŒ Aè‚¡ã€ç¾è‚¡ã€æ¸¯è‚¡ä¸‰ç§å¸‚åœºçš„ä»£ç æ ¼å¼éªŒè¯å’Œè‡ªåŠ¨è¯†åˆ«ã€‚

## æ”¯æŒçš„å¸‚åœºæ ¼å¼

### 1. Aè‚¡å¸‚åœº ğŸ‡¨ğŸ‡³

**æ ¼å¼**ï¼š6ä½æ•°å­—

**æ”¯æŒçš„å‰ç¼€**ï¼š
- `60xxxx` - ä¸Šæµ·ä¸»æ¿ï¼ˆå¦‚ï¼š600519 è´µå·èŒ…å°ï¼‰
- `68xxxx` - ç§‘åˆ›æ¿ï¼ˆå¦‚ï¼š688981 ä¸­èŠ¯å›½é™…ï¼‰
- `00xxxx` - æ·±åœ³ä¸»æ¿ï¼ˆå¦‚ï¼š000001 å¹³å®‰é“¶è¡Œï¼‰
- `30xxxx` - åˆ›ä¸šæ¿ï¼ˆå¦‚ï¼š300750 å®å¾·æ—¶ä»£ï¼‰
- `43xxxx` - åŒ—äº¤æ‰€
- `83xxxx` - åŒ—äº¤æ‰€
- `87xxxx` - åŒ—äº¤æ‰€

**ç¤ºä¾‹**ï¼š
```
000001  âœ“ å¹³å®‰é“¶è¡Œ
600519  âœ“ è´µå·èŒ…å°
000858  âœ“ äº”ç²®æ¶²
300750  âœ“ å®å¾·æ—¶ä»£
```

**é”™è¯¯ç¤ºä¾‹**ï¼š
```
00001   âœ— åªæœ‰5ä½æ•°å­—
1234567 âœ— è¶…è¿‡6ä½æ•°å­—
50xxxx  âœ— å‰ç¼€ä¸æ­£ç¡®
```

### 2. ç¾è‚¡å¸‚åœº ğŸ‡ºğŸ‡¸

**æ ¼å¼**ï¼š1-5ä¸ªå¤§å†™å­—æ¯ï¼Œå¯èƒ½åŒ…å«ä¸€ä¸ªç‚¹å·

**ç‰¹ç‚¹**ï¼š
- å¤§å°å†™ä¸æ•æ„Ÿï¼ˆè‡ªåŠ¨è½¬æ¢ä¸ºå¤§å†™ï¼‰
- æ”¯æŒå¸¦ç‚¹å·çš„ä»£ç ï¼ˆå¦‚ï¼šBRK.Bï¼‰

**ç¤ºä¾‹**ï¼š
```
AAPL    âœ“ è‹¹æœ
MSFT    âœ“ å¾®è½¯
GOOGL   âœ“ è°·æ­Œ
TSLA    âœ“ ç‰¹æ–¯æ‹‰
BRK.B   âœ“ ä¼¯å…‹å¸Œå°”Bè‚¡
```

**é”™è¯¯ç¤ºä¾‹**ï¼š
```
ABCDEF  âœ— è¶…è¿‡5ä¸ªå­—æ¯
123     âœ— çº¯æ•°å­—
A.B.C   âœ— å¤šä¸ªç‚¹å·
```

### 3. æ¸¯è‚¡å¸‚åœº ğŸ‡­ğŸ‡°

**æ ¼å¼**ï¼š1-5ä½æ•°å­—

**ç‰¹ç‚¹**ï¼š
- è‡ªåŠ¨è¡¥é½å‰å¯¼0ï¼ˆå¦‚ï¼š700 â†’ 00700ï¼‰
- æ”¯æŒå¸¦å‰å¯¼0å’Œä¸å¸¦å‰å¯¼0çš„æ ¼å¼

**ç¤ºä¾‹**ï¼š
```
00700   âœ“ è…¾è®¯æ§è‚¡
09988   âœ“ é˜¿é‡Œå·´å·´
01810   âœ“ å°ç±³é›†å›¢
03690   âœ“ ç¾å›¢
700     âœ“ è…¾è®¯æ§è‚¡ï¼ˆè‡ªåŠ¨è¡¥é½ä¸º 00700ï¼‰
9988    âœ“ é˜¿é‡Œå·´å·´ï¼ˆè‡ªåŠ¨è¡¥é½ä¸º 09988ï¼‰
```

**é”™è¯¯ç¤ºä¾‹**ï¼š
```
123456  âœ— è¶…è¿‡5ä½æ•°å­—
0       âœ— æ— æ•ˆä»£ç 
```

## åŠŸèƒ½ç‰¹æ€§

### 1. å®æ—¶éªŒè¯

- **è¾“å…¥æ—¶æç¤º**ï¼šè¾“å…¥è‚¡ç¥¨ä»£ç æ—¶æ˜¾ç¤ºæ ¼å¼æç¤º
- **å¤±ç„¦éªŒè¯**ï¼šç¦»å¼€è¾“å…¥æ¡†æ—¶è‡ªåŠ¨éªŒè¯æ ¼å¼
- **å³æ—¶åé¦ˆ**ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯æˆ–æˆåŠŸæç¤º

### 2. è‡ªåŠ¨è¯†åˆ«

ç³»ç»Ÿä¼šæ ¹æ®è¾“å…¥çš„ä»£ç æ ¼å¼è‡ªåŠ¨è¯†åˆ«å¸‚åœºç±»å‹ï¼š

```typescript
// 6ä½æ•°å­— â†’ Aè‚¡
000001 â†’ è‡ªåŠ¨è¯†åˆ«ä¸º Aè‚¡

// 1-5ä¸ªå­—æ¯ â†’ ç¾è‚¡
AAPL â†’ è‡ªåŠ¨è¯†åˆ«ä¸º ç¾è‚¡

// 1-5ä½æ•°å­—ï¼ˆé6ä½ï¼‰â†’ æ¸¯è‚¡
700 â†’ è‡ªåŠ¨è¯†åˆ«ä¸º æ¸¯è‚¡
```

### 3. ä»£ç æ ‡å‡†åŒ–

- **Aè‚¡**ï¼šä¿æŒ6ä½æ•°å­—æ ¼å¼
- **ç¾è‚¡**ï¼šè‡ªåŠ¨è½¬æ¢ä¸ºå¤§å†™
- **æ¸¯è‚¡**ï¼šè‡ªåŠ¨è¡¥é½å‰å¯¼0è‡³5ä½

### 4. å¸‚åœºåˆ‡æ¢éªŒè¯

å½“ç”¨æˆ·åˆ‡æ¢å¸‚åœºç±»å‹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°éªŒè¯å·²è¾“å…¥çš„è‚¡ç¥¨ä»£ç ï¼Œç¡®ä¿ä»£ç ä¸å¸‚åœºç±»å‹åŒ¹é…ã€‚

## ç”¨æˆ·ç•Œé¢

### è¾“å…¥æ¡†å¢å¼º

```vue
<el-input
  v-model="analysisForm.stockCode"
  placeholder="å¦‚ï¼š000001ã€AAPLã€00700"
  clearable
  size="large"
  class="stock-input"
  :class="{ 'is-error': stockCodeError }"
  @blur="validateStockCodeInput"
  @input="onStockCodeInput"
>
  <template #prefix>
    <el-icon><TrendCharts /></el-icon>
  </template>
</el-input>
```

### é”™è¯¯æç¤º

```vue
<div v-if="stockCodeError" class="error-message">
  <el-icon><WarningFilled /></el-icon>
  {{ stockCodeError }}
</div>
```

### æˆåŠŸæç¤º

```vue
<div v-else-if="stockCodeHelp" class="help-message">
  <el-icon><InfoFilled /></el-icon>
  {{ stockCodeHelp }}
</div>
```

### å¸‚åœºé€‰æ‹©å™¨å¢å¼º

```vue
<el-select v-model="analysisForm.market" @change="onMarketChange">
  <el-option label="ğŸ‡¨ğŸ‡³ Aè‚¡å¸‚åœº" value="Aè‚¡">
    <span>ğŸ‡¨ğŸ‡³ Aè‚¡å¸‚åœº</span>
    <span style="color: #909399; font-size: 12px;">ï¼ˆ6ä½æ•°å­—ï¼‰</span>
  </el-option>
  <el-option label="ğŸ‡ºğŸ‡¸ ç¾è‚¡å¸‚åœº" value="ç¾è‚¡">
    <span>ğŸ‡ºğŸ‡¸ ç¾è‚¡å¸‚åœº</span>
    <span style="color: #909399; font-size: 12px;">ï¼ˆ1-5ä¸ªå­—æ¯ï¼‰</span>
  </el-option>
  <el-option label="ğŸ‡­ğŸ‡° æ¸¯è‚¡å¸‚åœº" value="æ¸¯è‚¡">
    <span>ğŸ‡­ğŸ‡° æ¸¯è‚¡å¸‚åœº</span>
    <span style="color: #909399; font-size: 12px;">ï¼ˆ1-5ä½æ•°å­—ï¼‰</span>
  </el-option>
</el-select>
```

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒå·¥å…·å‡½æ•°

**æ–‡ä»¶**ï¼š`frontend/src/utils/stockValidator.ts`

#### 1. `validateAStock(code: string)`

éªŒè¯ Aè‚¡ä»£ç æ ¼å¼

```typescript
export function validateAStock(code: string): StockValidationResult {
  const cleanCode = code.trim().replace(/[^0-9]/g, '')
  
  if (!/^\d{6}$/.test(cleanCode)) {
    return { valid: false, message: 'Aè‚¡ä»£ç å¿…é¡»æ˜¯6ä½æ•°å­—' }
  }
  
  const prefix = cleanCode.substring(0, 2)
  const validPrefixes = ['60', '68', '00', '30', '43', '83', '87']
  
  if (!validPrefixes.includes(prefix)) {
    return { valid: false, message: 'Aè‚¡ä»£ç å‰ç¼€ä¸æ­£ç¡®' }
  }
  
  return { valid: true, market: 'Aè‚¡', normalizedCode: cleanCode }
}
```

#### 2. `validateUSStock(code: string)`

éªŒè¯ç¾è‚¡ä»£ç æ ¼å¼

```typescript
export function validateUSStock(code: string): StockValidationResult {
  const cleanCode = code.trim().toUpperCase().replace(/[^A-Z.]/g, '')
  
  if (!/^[A-Z]{1,5}(\.[A-Z])?$/.test(cleanCode)) {
    return { valid: false, message: 'ç¾è‚¡ä»£ç æ ¼å¼ä¸æ­£ç¡®' }
  }
  
  return { valid: true, market: 'ç¾è‚¡', normalizedCode: cleanCode }
}
```

#### 3. `validateHKStock(code: string)`

éªŒè¯æ¸¯è‚¡ä»£ç æ ¼å¼

```typescript
export function validateHKStock(code: string): StockValidationResult {
  const cleanCode = code.trim().replace(/[^0-9]/g, '')
  
  if (!/^\d{1,5}$/.test(cleanCode)) {
    return { valid: false, message: 'æ¸¯è‚¡ä»£ç å¿…é¡»æ˜¯1-5ä½æ•°å­—' }
  }
  
  const normalizedCode = cleanCode.padStart(5, '0')
  
  return { valid: true, market: 'æ¸¯è‚¡', normalizedCode: normalizedCode }
}
```

#### 4. `validateStockCode(code: string, marketHint?: string)`

è‡ªåŠ¨è¯†åˆ«å¹¶éªŒè¯è‚¡ç¥¨ä»£ç 

```typescript
export function validateStockCode(
  code: string,
  marketHint?: 'Aè‚¡' | 'ç¾è‚¡' | 'æ¸¯è‚¡'
): StockValidationResult {
  if (!code || !code.trim()) {
    return { valid: false, message: 'è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ' }
  }
  
  // å¦‚æœæä¾›äº†å¸‚åœºæç¤ºï¼Œä¼˜å…ˆéªŒè¯è¯¥å¸‚åœº
  if (marketHint) {
    switch (marketHint) {
      case 'Aè‚¡': return validateAStock(code)
      case 'ç¾è‚¡': return validateUSStock(code)
      case 'æ¸¯è‚¡': return validateHKStock(code)
    }
  }
  
  // è‡ªåŠ¨è¯†åˆ«å¸‚åœºç±»å‹
  // ...
}
```

### Vue ç»„ä»¶é›†æˆ

**æ–‡ä»¶**ï¼š`frontend/src/views/Analysis/SingleAnalysis.vue`

#### å“åº”å¼çŠ¶æ€

```typescript
// è‚¡ç¥¨ä»£ç éªŒè¯ç›¸å…³
const stockCodeError = ref<string>('')
const stockCodeHelp = ref<string>('')
```

#### äº‹ä»¶å¤„ç†å‡½æ•°

```typescript
// è‚¡ç¥¨ä»£ç è¾“å…¥æ—¶çš„å¤„ç†
const onStockCodeInput = () => {
  stockCodeError.value = ''
  stockCodeHelp.value = getStockCodeFormatHelp(analysisForm.market)
}

// å¸‚åœºç±»å‹å˜æ›´æ—¶çš„å¤„ç†
const onMarketChange = () => {
  if (analysisForm.stockCode.trim()) {
    validateStockCodeInput()
  } else {
    stockCodeHelp.value = getStockCodeFormatHelp(analysisForm.market)
  }
}

// éªŒè¯è‚¡ç¥¨ä»£ç è¾“å…¥
const validateStockCodeInput = () => {
  const code = analysisForm.stockCode.trim()
  
  if (!code) {
    stockCodeError.value = ''
    stockCodeHelp.value = ''
    return
  }
  
  const validation = validateStockCode(code, analysisForm.market)
  
  if (!validation.valid) {
    stockCodeError.value = validation.message || 'è‚¡ç¥¨ä»£ç æ ¼å¼ä¸æ­£ç¡®'
    stockCodeHelp.value = ''
  } else {
    stockCodeError.value = ''
    stockCodeHelp.value = `âœ“ ${validation.market}ä»£ç æ ¼å¼æ­£ç¡®`
    
    // è‡ªåŠ¨æ›´æ–°å¸‚åœºç±»å‹
    if (validation.market && validation.market !== analysisForm.market) {
      analysisForm.market = validation.market
      ElMessage.success(`å·²è‡ªåŠ¨è¯†åˆ«ä¸º${validation.market}`)
    }
    
    // æ ‡å‡†åŒ–ä»£ç 
    if (validation.normalizedCode) {
      analysisForm.stockCode = validation.normalizedCode
    }
  }
}
```

## æ ·å¼å®šä¹‰

```scss
.stock-input {
  :deep(.el-input__inner) {
    font-weight: 600;
    text-transform: uppercase;
  }

  &.is-error {
    :deep(.el-input__inner) {
      border-color: #f56c6c;
    }
  }
}

.error-message {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 8px;
  font-size: 12px;
  color: #f56c6c;
}

.help-message {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 8px;
  font-size: 12px;
  color: #67c23a;
}
```

## ä½¿ç”¨æµç¨‹

### 1. ç”¨æˆ·è¾“å…¥è‚¡ç¥¨ä»£ç 

```
ç”¨æˆ·è¾“å…¥: 000001
â†“
æ˜¾ç¤ºæç¤º: "Aè‚¡ä»£ç å¿…é¡»æ˜¯6ä½æ•°å­—"
```

### 2. å¤±ç„¦éªŒè¯

```
ç”¨æˆ·ç¦»å¼€è¾“å…¥æ¡†
â†“
è‡ªåŠ¨éªŒè¯æ ¼å¼
â†“
æ˜¾ç¤ºç»“æœ: "âœ“ Aè‚¡ä»£ç æ ¼å¼æ­£ç¡®"
```

### 3. æäº¤åˆ†æ

```
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æ™ºèƒ½åˆ†æ"
â†“
å†æ¬¡éªŒè¯ä»£ç æ ¼å¼
â†“
å¦‚æœæ ¼å¼é”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤ºå¹¶é˜»æ­¢æäº¤
â†“
å¦‚æœæ ¼å¼æ­£ç¡®ï¼Œä½¿ç”¨æ ‡å‡†åŒ–åçš„ä»£ç æäº¤åˆ†æ
```

## æµ‹è¯•ç”¨ä¾‹

### Aè‚¡æµ‹è¯•

| è¾“å…¥ | é¢„æœŸç»“æœ | è¯´æ˜ |
|------|---------|------|
| `000001` | âœ“ é€šè¿‡ | å¹³å®‰é“¶è¡Œ |
| `600519` | âœ“ é€šè¿‡ | è´µå·èŒ…å° |
| `00001` | âœ— å¤±è´¥ | åªæœ‰5ä½ |
| `1234567` | âœ— å¤±è´¥ | è¶…è¿‡6ä½ |
| `500001` | âœ— å¤±è´¥ | å‰ç¼€ä¸æ­£ç¡® |

### ç¾è‚¡æµ‹è¯•

| è¾“å…¥ | é¢„æœŸç»“æœ | æ ‡å‡†åŒ–å | è¯´æ˜ |
|------|---------|---------|------|
| `aapl` | âœ“ é€šè¿‡ | `AAPL` | è‹¹æœ |
| `MSFT` | âœ“ é€šè¿‡ | `MSFT` | å¾®è½¯ |
| `brk.b` | âœ“ é€šè¿‡ | `BRK.B` | ä¼¯å…‹å¸Œå°”Bè‚¡ |
| `ABCDEF` | âœ— å¤±è´¥ | - | è¶…è¿‡5ä¸ªå­—æ¯ |
| `123` | âœ— å¤±è´¥ | - | çº¯æ•°å­— |

### æ¸¯è‚¡æµ‹è¯•

| è¾“å…¥ | é¢„æœŸç»“æœ | æ ‡å‡†åŒ–å | è¯´æ˜ |
|------|---------|---------|------|
| `700` | âœ“ é€šè¿‡ | `00700` | è…¾è®¯æ§è‚¡ |
| `00700` | âœ“ é€šè¿‡ | `00700` | è…¾è®¯æ§è‚¡ |
| `9988` | âœ“ é€šè¿‡ | `09988` | é˜¿é‡Œå·´å·´ |
| `123456` | âœ— å¤±è´¥ | - | è¶…è¿‡5ä½ |

## æ€»ç»“

### ä¼˜ç‚¹

1. âœ… **ç”¨æˆ·ä½“éªŒå¥½**ï¼šå®æ—¶åé¦ˆï¼Œå³æ—¶æç¤º
2. âœ… **æ™ºèƒ½è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«å¸‚åœºç±»å‹
3. âœ… **ä»£ç æ ‡å‡†åŒ–**ï¼šè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
4. âœ… **é˜²æ­¢é”™è¯¯**ï¼šæäº¤å‰éªŒè¯ï¼Œé¿å…æ— æ•ˆè¯·æ±‚
5. âœ… **æ˜“äºç»´æŠ¤**ï¼šç‹¬ç«‹çš„å·¥å…·å‡½æ•°ï¼Œæ˜“äºæµ‹è¯•å’Œæ‰©å±•

### åç»­ä¼˜åŒ–æ–¹å‘

1. æ·»åŠ æ›´å¤šå¸‚åœºæ”¯æŒï¼ˆå¦‚ï¼šæ–°åŠ å¡ã€æ—¥æœ¬ç­‰ï¼‰
2. é›†æˆè‚¡ç¥¨åç§°è‡ªåŠ¨è¡¥å…¨
3. æ·»åŠ å†å²è¾“å…¥è®°å½•
4. æ”¯æŒæ‰¹é‡ä»£ç éªŒè¯

