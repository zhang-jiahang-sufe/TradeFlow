# ğŸ”„ å¢å¼ºæ•°æ®æ•´åˆä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

å¢å¼ºæ•°æ®æ•´åˆåŠŸèƒ½é€šè¿‡ `TA_USE_APP_CACHE` é…ç½®ï¼Œè®© TradingAgents åˆ†ææœåŠ¡ä¼˜å…ˆä½¿ç”¨ MongoDB ä¸­çš„åŒæ­¥æ•°æ®ï¼Œæä¾›æ›´å¿«é€Ÿã€æ›´å‡†ç¡®çš„æ•°æ®è®¿é—®ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. **æ™ºèƒ½æ•°æ®é™çº§**
- **ä¼˜å…ˆçº§1**: MongoDB åŒæ­¥æ•°æ®ï¼ˆæœ€æ–°ã€æœ€å‡†ç¡®ï¼‰
- **ä¼˜å…ˆçº§2**: æ–‡ä»¶ç¼“å­˜æ•°æ®ï¼ˆå¿«é€Ÿè®¿é—®ï¼‰
- **ä¼˜å…ˆçº§3**: API å®æ—¶è·å–ï¼ˆå…œåº•ä¿éšœï¼‰

### 2. **é…ç½®é©±åŠ¨**
- é€šè¿‡ `TA_USE_APP_CACHE` ç¯å¢ƒå˜é‡æ§åˆ¶
- æ— éœ€ä¿®æ”¹ä»£ç ï¼Œçµæ´»åˆ‡æ¢æ¨¡å¼
- å‘åå…¼å®¹ç°æœ‰åŠŸèƒ½

### 3. **å¤šæ•°æ®ç±»å‹æ”¯æŒ**
- âœ… è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
- âœ… å†å²ä»·æ ¼æ•°æ®
- âœ… è´¢åŠ¡æ•°æ®
- âœ… æ–°é—»æ•°æ®
- âœ… ç¤¾åª’æ•°æ®
- âœ… å®æ—¶è¡Œæƒ…

## ğŸ”§ é…ç½®æ–¹æ³•

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```bash
# å¯ç”¨MongoDBä¼˜å…ˆæ¨¡å¼
TA_USE_APP_CACHE=true

# ç¦ç”¨MongoDBä¼˜å…ˆæ¨¡å¼ï¼ˆä½¿ç”¨ä¼ ç»Ÿç¼“å­˜ï¼‰
TA_USE_APP_CACHE=false
```

### è¿è¡Œæ—¶é…ç½®

```python
import os

# å¯ç”¨MongoDBä¼˜å…ˆæ¨¡å¼
os.environ['TA_USE_APP_CACHE'] = 'true'

# ç¦ç”¨MongoDBä¼˜å…ˆæ¨¡å¼
os.environ['TA_USE_APP_CACHE'] = 'false'
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. **åŸºæœ¬ä½¿ç”¨**

```python
from tradingagents.dataflows.optimized_china_data import get_optimized_china_data_provider

# è·å–æ•°æ®æä¾›å™¨
provider = get_optimized_china_data_provider()

# è·å–è‚¡ç¥¨æ•°æ®ï¼ˆè‡ªåŠ¨ä½¿ç”¨MongoDBä¼˜å…ˆï¼‰
stock_data = provider.get_stock_data("000001", "2024-01-01", "2024-01-31")

# è·å–åŸºæœ¬é¢æ•°æ®ï¼ˆè‡ªåŠ¨ä½¿ç”¨MongoDBè´¢åŠ¡æ•°æ®ï¼‰
fundamentals = provider.get_fundamentals_data("000001")
```

### 2. **ç›´æ¥ä½¿ç”¨å¢å¼ºé€‚é…å™¨**

```python
from tradingagents.dataflows.enhanced_data_adapter import get_enhanced_data_adapter

# è·å–é€‚é…å™¨
adapter = get_enhanced_data_adapter()

# æ£€æŸ¥æ˜¯å¦å¯ç”¨MongoDBæ¨¡å¼
if adapter.use_app_cache:
    print("ğŸ“Š MongoDBä¼˜å…ˆæ¨¡å¼å·²å¯ç”¨")
else:
    print("ğŸ“ ä¼ ç»Ÿç¼“å­˜æ¨¡å¼")

# è·å–å„ç±»æ•°æ®
basic_info = adapter.get_stock_basic_info("000001")
historical_data = adapter.get_historical_data("000001", "20240101", "20240131")
financial_data = adapter.get_financial_data("000001")
news_data = adapter.get_news_data("000001", hours_back=24)
social_data = adapter.get_social_media_data("000001", hours_back=24)
```

### 3. **å¸¦é™çº§çš„æ•°æ®è·å–**

```python
from tradingagents.dataflows.enhanced_data_adapter import (
    get_stock_data_with_fallback,
    get_financial_data_with_fallback
)

# å®šä¹‰é™çº§å‡½æ•°
def fallback_stock_data(symbol, start_date, end_date):
    # ä¼ ç»ŸAPIè·å–æ–¹å¼
    return get_traditional_stock_data(symbol, start_date, end_date)

# ä½¿ç”¨å¸¦é™çº§çš„æ•°æ®è·å–
data = get_stock_data_with_fallback(
    symbol="000001",
    start_date="20240101",
    end_date="20240131",
    fallback_func=fallback_stock_data
)
```

## ğŸ“Š æ•°æ®æµç¨‹å›¾

```
ç”¨æˆ·è¯·æ±‚
    â†“
æ£€æŸ¥ TA_USE_APP_CACHE
    â†“
[å¯ç”¨] â†’ MongoDBæŸ¥è¯¢ â†’ [æœ‰æ•°æ®] â†’ è¿”å›ç»“æœ
    â†“                    â†“
[ç¦ç”¨]              [æ— æ•°æ®]
    â†“                    â†“
æ–‡ä»¶ç¼“å­˜æŸ¥è¯¢ â† â† â† â† â† â† â† â†
    â†“
[æœ‰ç¼“å­˜] â†’ è¿”å›ç¼“å­˜
    â†“
[æ— ç¼“å­˜]
    â†“
APIå®æ—¶è·å– â†’ ä¿å­˜ç¼“å­˜ â†’ è¿”å›ç»“æœ
```

## ğŸ¯ æ€§èƒ½å¯¹æ¯”

### MongoDBä¼˜å…ˆæ¨¡å¼
- âœ… **é€Ÿåº¦**: æ¯«ç§’çº§å“åº”
- âœ… **å‡†ç¡®æ€§**: æœ€æ–°åŒæ­¥æ•°æ®
- âœ… **ç¨³å®šæ€§**: æ— APIé™åˆ¶
- âœ… **å®Œæ•´æ€§**: å¤šç»´åº¦æ•°æ®

### ä¼ ç»Ÿç¼“å­˜æ¨¡å¼
- âš¡ **é€Ÿåº¦**: ç§’çº§å“åº”
- ğŸ“Š **å‡†ç¡®æ€§**: ç¼“å­˜æ•°æ®
- âš ï¸ **ç¨³å®šæ€§**: å—APIé™åˆ¶
- ğŸ“ˆ **å®Œæ•´æ€§**: åŸºç¡€æ•°æ®

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æ—¥å¿—è¾“å‡º

å¯ç”¨MongoDBæ¨¡å¼æ—¶ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼æ—¥å¿—ï¼š

```
ğŸ“Š å¢å¼ºæ•°æ®é€‚é…å™¨å·²å¯ç”¨ - ä¼˜å…ˆä½¿ç”¨MongoDBæ•°æ®
âœ… ä»MongoDBè·å–åŸºç¡€ä¿¡æ¯: 000001
ğŸ“Š ä½¿ç”¨MongoDBå†å²æ•°æ®: 000001
ğŸ’° ä½¿ç”¨MongoDBè´¢åŠ¡æ•°æ®: 000001
```

ç¦ç”¨æ—¶ä¼šçœ‹åˆ°ï¼š

```
ğŸ“ å¢å¼ºæ•°æ®é€‚é…å™¨ä½¿ç”¨ä¼ ç»Ÿç¼“å­˜æ¨¡å¼
âš¡ ä»ç¼“å­˜åŠ è½½Aè‚¡æ•°æ®: 000001
ğŸŒ ä»Tushareæ•°æ®æ¥å£è·å–æ•°æ®: 000001
```

### æ€§èƒ½ç›‘æ§

```python
import time
from tradingagents.dataflows.optimized_china_data import get_optimized_china_data_provider

provider = get_optimized_china_data_provider()

# æµ‹è¯•æ€§èƒ½
start_time = time.time()
data = provider.get_stock_data("000001", "2024-01-01", "2024-01-31")
elapsed = time.time() - start_time

print(f"â±ï¸ æ•°æ®è·å–è€—æ—¶: {elapsed:.2f}ç§’")
print(f"ğŸ“Š æ•°æ®é•¿åº¦: {len(data)} å­—ç¬¦")
```

## ğŸ§ª æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
# è¿è¡Œé›†æˆæµ‹è¯•
python examples/test_enhanced_data_integration.py
```

æµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š
- âœ… å¢å¼ºæ•°æ®é€‚é…å™¨åŠŸèƒ½
- âœ… ä¼˜åŒ–æ•°æ®æä¾›å™¨åŠŸèƒ½
- âœ… ç¼“å­˜æ¨¡å¼å¯¹æ¯”
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. **æ•°æ®ä¸€è‡´æ€§**
- MongoDBæ•°æ®ä¾èµ–åŒæ­¥æœåŠ¡
- ç¡®ä¿åŒæ­¥æœåŠ¡æ­£å¸¸è¿è¡Œ
- å®šæœŸæ£€æŸ¥æ•°æ®æ›´æ–°çŠ¶æ€

### 2. **æ€§èƒ½è€ƒè™‘**
- MongoDBæŸ¥è¯¢éœ€è¦åˆé€‚çš„ç´¢å¼•
- å¤§é‡æ•°æ®æŸ¥è¯¢æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨
- é€‚å½“è®¾ç½®æŸ¥è¯¢é™åˆ¶

### 3. **é”™è¯¯å¤„ç†**
- MongoDBè¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é™çº§
- æ•°æ®æ ¼å¼å¼‚å¸¸æ—¶ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
- å®Œå–„çš„æ—¥å¿—è®°å½•ä¾¿äºæ’æŸ¥

### 4. **é…ç½®ç®¡ç†**
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨MongoDBæ¨¡å¼
- å¼€å‘ç¯å¢ƒå¯æ ¹æ®éœ€è¦é€‰æ‹©
- æµ‹è¯•ç¯å¢ƒå»ºè®®ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **MongoDBè¿æ¥å¤±è´¥**
   ```
   âš ï¸ MongoDBè¿æ¥åˆå§‹åŒ–å¤±è´¥: connection refused
   ```
   - æ£€æŸ¥MongoDBæœåŠ¡çŠ¶æ€
   - éªŒè¯è¿æ¥é…ç½®
   - ç¡®è®¤ç½‘ç»œè¿é€šæ€§

2. **æ•°æ®æ ¼å¼ä¸åŒ¹é…**
   ```
   âš ï¸ æ ¼å¼åŒ–è´¢åŠ¡æ•°æ®å¤±è´¥: KeyError
   ```
   - æ£€æŸ¥æ•°æ®åº“å­—æ®µæ˜ å°„
   - éªŒè¯æ•°æ®å®Œæ•´æ€§
   - æ›´æ–°å­—æ®µå¤„ç†é€»è¾‘

3. **æ€§èƒ½é—®é¢˜**
   ```
   â±ï¸ æŸ¥è¯¢è€—æ—¶è¿‡é•¿
   ```
   - æ£€æŸ¥æ•°æ®åº“ç´¢å¼•
   - ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶
   - è€ƒè™‘æ•°æ®åˆ†é¡µ

## ğŸš€ æœ€ä½³å®è·µ

1. **ç”Ÿäº§ç¯å¢ƒé…ç½®**
   ```bash
   TA_USE_APP_CACHE=true
   ```

2. **å¼€å‘ç¯å¢ƒé…ç½®**
   ```bash
   TA_USE_APP_CACHE=false  # æˆ–æ ¹æ®éœ€è¦
   ```

3. **ç›‘æ§é…ç½®**
   - å¯ç”¨è¯¦ç»†æ—¥å¿—
   - ç›‘æ§æ•°æ®åº“æ€§èƒ½
   - è®¾ç½®å‘Šè­¦é˜ˆå€¼

4. **æ•°æ®ç®¡ç†**
   - å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
   - ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨
   - å¤‡ä»½é‡è¦æ•°æ®

é€šè¿‡è¿™ä¸ªå¢å¼ºæ•°æ®æ•´åˆåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥å……åˆ†åˆ©ç”¨å·²åŒæ­¥çš„MongoDBæ•°æ®ï¼Œæå‡åˆ†ææœåŠ¡çš„æ€§èƒ½å’Œå‡†ç¡®æ€§ï¼ğŸ‰
