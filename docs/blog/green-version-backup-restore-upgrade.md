# TradingAgents ç»¿è‰²ç‰ˆï¼šæ•°æ®å¤‡ä»½ã€è¿˜åŸä¸å‡çº§å®Œå…¨æŒ‡å—

> **ä½œè€…**: TradingAgents å›¢é˜Ÿ  
> **æ—¥æœŸ**: 2025-11-06  
> **æ ‡ç­¾**: ç»¿è‰²ç‰ˆ, æ•°æ®å¤‡ä»½, å‡çº§æŒ‡å—, è¿ç»´

---

## ğŸ“‹ ç›®å½•

- [1. ä»€ä¹ˆæ˜¯ç»¿è‰²ç‰ˆ](#1-ä»€ä¹ˆæ˜¯ç»¿è‰²ç‰ˆ)
- [2. æ•°æ®å¤‡ä»½](#2-æ•°æ®å¤‡ä»½)
  - [2.1 éœ€è¦å¤‡ä»½çš„å†…å®¹](#21-éœ€è¦å¤‡ä»½çš„å†…å®¹)
  - [2.2 æ‰‹åŠ¨å¤‡ä»½](#22-æ‰‹åŠ¨å¤‡ä»½)
  - [2.3 è‡ªåŠ¨å¤‡ä»½è„šæœ¬](#23-è‡ªåŠ¨å¤‡ä»½è„šæœ¬)
- [3. æ•°æ®è¿˜åŸ](#3-æ•°æ®è¿˜åŸ)
  - [3.1 å®Œæ•´è¿˜åŸ](#31-å®Œæ•´è¿˜åŸ)
  - [3.2 é€‰æ‹©æ€§è¿˜åŸ](#32-é€‰æ‹©æ€§è¿˜åŸ)
- [4. ç‰ˆæœ¬å‡çº§](#4-ç‰ˆæœ¬å‡çº§)
  - [4.1 å‡çº§å‰å‡†å¤‡](#41-å‡çº§å‰å‡†å¤‡)
  - [4.2 å‡çº§æ­¥éª¤](#42-å‡çº§æ­¥éª¤)
  - [4.3 å‡çº§åéªŒè¯](#43-å‡çº§åéªŒè¯)
- [5. å¸¸è§é—®é¢˜](#5-å¸¸è§é—®é¢˜)
- [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)

---

## 1. ä»€ä¹ˆæ˜¯ç»¿è‰²ç‰ˆ

**ç»¿è‰²ç‰ˆ**ï¼ˆPortable Versionï¼‰æ˜¯æŒ‡æ— éœ€å®‰è£…ã€è§£å‹å³ç”¨çš„è½¯ä»¶ç‰ˆæœ¬ã€‚TradingAgents ç»¿è‰²ç‰ˆå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

âœ… **å…å®‰è£…**ï¼šè§£å‹åˆ°ä»»æ„ç›®å½•å³å¯è¿è¡Œ  
âœ… **æ•°æ®ç‹¬ç«‹**ï¼šæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ç¨‹åºç›®å½•å†…  
âœ… **æ˜“äºè¿ç§»**ï¼šæ•´ä¸ªæ–‡ä»¶å¤¹å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°å…¶ä»–ç”µè„‘  
âœ… **å¤šç‰ˆæœ¬å…±å­˜**ï¼šå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªç‰ˆæœ¬è¿›è¡Œæµ‹è¯•  

---

## 2. æ•°æ®å¤‡ä»½

### 2.1 éœ€è¦å¤‡ä»½çš„å†…å®¹

åœ¨ TradingAgents ç»¿è‰²ç‰ˆä¸­ï¼Œä»¥ä¸‹å†…å®¹éœ€è¦å®šæœŸå¤‡ä»½ï¼š

#### ï¿½ï¸ MongoDB æ•°æ®åº“ï¼ˆæ ¸å¿ƒæ•°æ®ï¼‰

TradingAgents ä½¿ç”¨ MongoDB å­˜å‚¨æ‰€æœ‰æ ¸å¿ƒæ•°æ®ï¼Œè¿™æ˜¯**æœ€é‡è¦**çš„å¤‡ä»½å†…å®¹ï¼š

| æ•°æ®åº“/é›†åˆ | è¯´æ˜ | é‡è¦æ€§ | å¤§å°ä¼°ç®— |
|-----------|------|--------|---------|
| **`tradingagents`** | ä¸»æ•°æ®åº“ | â­â­â­â­â­ | 1GB - 100GB |
| â”œâ”€ `stock_daily_quotes` | è‚¡ç¥¨æ—¥çº¿æ•°æ®ï¼ˆå‰å¤æƒï¼‰ | â­â­â­â­â­ | 500MB - 50GB |
| â”œâ”€ `stock_basic_info` | è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ | â­â­â­â­â­ | 10MB - 100MB |
| â”œâ”€ `news_data` | æ–°é—»æ•°æ® | â­â­â­â­ | 100MB - 10GB |
| â”œâ”€ `insider_sentiment` | å†…éƒ¨äººæƒ…ç»ªæ•°æ® | â­â­â­â­ | 50MB - 5GB |
| â”œâ”€ `insider_transactions` | å†…éƒ¨äººäº¤æ˜“æ•°æ® | â­â­â­â­ | 50MB - 5GB |
| â”œâ”€ `analysis_results` | åˆ†æç»“æœ | â­â­â­ | 10MB - 1GB |
| â””â”€ `agent_conversations` | æ™ºèƒ½ä½“å¯¹è¯å†å² | â­â­â­ | 10MB - 1GB |
| **`config`** | é…ç½®æ•°æ®åº“ | â­â­â­â­ | < 10MB |
| â””â”€ `system_config` | ç³»ç»Ÿé…ç½® | â­â­â­â­ | < 1MB |

#### ï¿½ é…ç½®æ–‡ä»¶

| æ–‡ä»¶/ç›®å½• | è¯´æ˜ | é‡è¦æ€§ | å¤§å°ä¼°ç®— |
|----------|------|--------|---------|
| **`.env`** | ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼ˆåŒ…å« API Tokenï¼‰ | â­â­â­â­â­ | < 10KB |
| **`config/`** | JSON é…ç½®æ–‡ä»¶ | â­â­â­â­ | < 1MB |
| **`logs/`** | æ—¥å¿—æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ | â­â­ | 10MB - 1GB |

---

### 2.2 MongoDB æ•°æ®å¤‡ä»½

#### æ–¹æ³• 1ï¼šä½¿ç”¨ mongodumpï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå®Œæ•´å¤‡ä»½ã€å®šæœŸå¤‡ä»½ã€è¿ç§»æ•°æ®

##### Windows å¤‡ä»½è„šæœ¬

```powershell
# MongoDB å®Œæ•´å¤‡ä»½è„šæœ¬
# ä¿å­˜ä¸ºï¼šscripts/backup/backup_mongodb.ps1

param(
    [string]$MongoHost = "localhost",
    [int]$MongoPort = 27017,
    [string]$Database = "tradingagents",
    [string]$BackupDir = "C:\Backups\MongoDB"
)

# åˆ›å»ºå¤‡ä»½ç›®å½•
$backupDate = Get-Date -Format "yyyyMMdd_HHmmss"
$todayBackup = Join-Path $BackupDir "mongodb_$backupDate"
New-Item -ItemType Directory -Path $todayBackup -Force | Out-Null

Write-Host "ğŸ”„ å¼€å§‹å¤‡ä»½ MongoDB æ•°æ®åº“..." -ForegroundColor Cyan
Write-Host "ğŸ“Š æ•°æ®åº“: $Database" -ForegroundColor Yellow
Write-Host "ğŸ“ å¤‡ä»½ç›®å½•: $todayBackup" -ForegroundColor Yellow

# æ‰§è¡Œ mongodump
try {
    # å¤‡ä»½æ•´ä¸ªæ•°æ®åº“
    mongodump --host $MongoHost --port $MongoPort --db $Database --out $todayBackup

    if ($LASTEXITCODE -eq 0) {
        Write-Host "âœ… MongoDB å¤‡ä»½æˆåŠŸï¼" -ForegroundColor Green

        # å‹ç¼©å¤‡ä»½
        Write-Host "ğŸ—œï¸  å‹ç¼©å¤‡ä»½æ–‡ä»¶..." -ForegroundColor Yellow
        $zipFile = "$todayBackup.zip"
        Compress-Archive -Path $todayBackup -DestinationPath $zipFile -Force

        # åˆ é™¤æœªå‹ç¼©çš„å¤‡ä»½
        Remove-Item -Path $todayBackup -Recurse -Force

        # æ˜¾ç¤ºå¤‡ä»½ä¿¡æ¯
        $backupSize = [math]::Round((Get-Item $zipFile).Length / 1MB, 2)
        Write-Host "ğŸ“¦ å¤‡ä»½æ–‡ä»¶ï¼š$zipFile" -ForegroundColor Green
        Write-Host "ğŸ“Š å¤‡ä»½å¤§å°ï¼š$backupSize MB" -ForegroundColor Green
    } else {
        Write-Host "âŒ MongoDB å¤‡ä»½å¤±è´¥ï¼" -ForegroundColor Red
        exit 1
    }
} catch {
    Write-Host "âŒ å¤‡ä»½è¿‡ç¨‹å‡ºé”™ï¼š$_" -ForegroundColor Red
    exit 1
}
```

##### Linux / macOS å¤‡ä»½è„šæœ¬

```bash
#!/bin/bash
# MongoDB å®Œæ•´å¤‡ä»½è„šæœ¬
# ä¿å­˜ä¸ºï¼šscripts/backup/backup_mongodb.sh

MONGO_HOST="localhost"
MONGO_PORT=27017
DATABASE="tradingagents"
BACKUP_DIR="/backups/mongodb"

# åˆ›å»ºå¤‡ä»½ç›®å½•
BACKUP_DATE=$(date +%Y%m%d_%H%M%S)
TODAY_BACKUP="$BACKUP_DIR/mongodb_$BACKUP_DATE"
mkdir -p "$TODAY_BACKUP"

echo "ğŸ”„ å¼€å§‹å¤‡ä»½ MongoDB æ•°æ®åº“..."
echo "ğŸ“Š æ•°æ®åº“: $DATABASE"
echo "ğŸ“ å¤‡ä»½ç›®å½•: $TODAY_BACKUP"

# æ‰§è¡Œ mongodump
mongodump --host $MONGO_HOST --port $MONGO_PORT --db $DATABASE --out $TODAY_BACKUP

if [ $? -eq 0 ]; then
    echo "âœ… MongoDB å¤‡ä»½æˆåŠŸï¼"

    # å‹ç¼©å¤‡ä»½
    echo "ğŸ—œï¸  å‹ç¼©å¤‡ä»½æ–‡ä»¶..."
    tar -czf "$TODAY_BACKUP.tar.gz" -C "$BACKUP_DIR" "mongodb_$BACKUP_DATE"

    # åˆ é™¤æœªå‹ç¼©çš„å¤‡ä»½
    rm -rf "$TODAY_BACKUP"

    # æ˜¾ç¤ºå¤‡ä»½ä¿¡æ¯
    BACKUP_SIZE=$(du -h "$TODAY_BACKUP.tar.gz" | cut -f1)
    echo "ğŸ“¦ å¤‡ä»½æ–‡ä»¶ï¼š$TODAY_BACKUP.tar.gz"
    echo "ğŸ“Š å¤‡ä»½å¤§å°ï¼š$BACKUP_SIZE"
else
    echo "âŒ MongoDB å¤‡ä»½å¤±è´¥ï¼"
    exit 1
fi
```

##### ä½¿ç”¨æ–¹æ³•

```bash
# Windows
powershell -ExecutionPolicy Bypass -File scripts/backup/backup_mongodb.ps1

# Linux / macOS
chmod +x scripts/backup/backup_mongodb.sh
./scripts/backup/backup_mongodb.sh
```

---

#### æ–¹æ³• 2ï¼šå¤‡ä»½ç‰¹å®šé›†åˆ

**é€‚ç”¨åœºæ™¯**ï¼šåªå¤‡ä»½é‡è¦æ•°æ®ã€èŠ‚çœç©ºé—´

```bash
# Windows PowerShell
$backupDate = Get-Date -Format "yyyyMMdd_HHmmss"
$backupDir = "C:\Backups\MongoDB\partial_$backupDate"

# åªå¤‡ä»½è‚¡ç¥¨æ•°æ®å’Œé…ç½®
mongodump --host localhost --port 27017 --db tradingagents `
    --collection stock_daily_quotes `
    --collection stock_basic_info `
    --collection system_config `
    --out $backupDir

# å‹ç¼©
Compress-Archive -Path $backupDir -DestinationPath "$backupDir.zip" -Force
Remove-Item -Path $backupDir -Recurse -Force
```

```bash
# Linux / macOS
backup_date=$(date +%Y%m%d_%H%M%S)
backup_dir="/backups/mongodb/partial_$backup_date"

# åªå¤‡ä»½è‚¡ç¥¨æ•°æ®å’Œé…ç½®
mongodump --host localhost --port 27017 --db tradingagents \
    --collection stock_daily_quotes \
    --collection stock_basic_info \
    --collection system_config \
    --out $backup_dir

# å‹ç¼©
tar -czf "$backup_dir.tar.gz" -C /backups/mongodb "partial_$backup_date"
rm -rf "$backup_dir"
```

---

#### æ–¹æ³• 3ï¼šå¢é‡å¤‡ä»½ï¼ˆé«˜çº§ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæ•°æ®é‡å¤§ã€éœ€è¦é¢‘ç¹å¤‡ä»½

```bash
# ä½¿ç”¨ MongoDB Oplog è¿›è¡Œå¢é‡å¤‡ä»½
# éœ€è¦ MongoDB é…ç½®ä¸ºå‰¯æœ¬é›†æ¨¡å¼

# é¦–æ¬¡å®Œæ•´å¤‡ä»½
mongodump --host localhost --port 27017 --db tradingagents --out /backups/full

# åç»­å¢é‡å¤‡ä»½ï¼ˆåªå¤‡ä»½å˜åŒ–çš„æ•°æ®ï¼‰
mongodump --host localhost --port 27017 --oplog --out /backups/incremental_$(date +%Y%m%d_%H%M%S)
```

---

### 2.3 é…ç½®æ–‡ä»¶å¤‡ä»½

é™¤äº† MongoDB æ•°æ®ï¼Œè¿˜éœ€è¦å¤‡ä»½é…ç½®æ–‡ä»¶ï¼š

```bash
# Windows PowerShell
$backupDate = Get-Date -Format "yyyyMMdd_HHmmss"
$configBackup = "C:\Backups\Config_$backupDate"
New-Item -ItemType Directory -Path $configBackup -Force | Out-Null

# å¤‡ä»½é…ç½®æ–‡ä»¶
Copy-Item -Path "C:\TradingAgentsCN\.env" -Destination $configBackup
Copy-Item -Path "C:\TradingAgentsCN\config\*.json" -Destination $configBackup

# å‹ç¼©
Compress-Archive -Path $configBackup -DestinationPath "$configBackup.zip" -Force
Remove-Item -Path $configBackup -Recurse -Force

Write-Host "âœ… é…ç½®æ–‡ä»¶å¤‡ä»½å®Œæˆï¼š$configBackup.zip" -ForegroundColor Green
```

---

### 2.4 è‡ªåŠ¨å¤‡ä»½è„šæœ¬

#### Windows è‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼ˆMongoDB + é…ç½®ï¼‰

åˆ›å»ºæ–‡ä»¶ `scripts/backup/auto_backup_all.ps1`ï¼š

```powershell
# TradingAgents å®Œæ•´è‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼ˆMongoDB + é…ç½®æ–‡ä»¶ï¼‰
# ä½¿ç”¨æ–¹æ³•ï¼šåœ¨ Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­è®¾ç½®å®šæ—¶è¿è¡Œ

param(
    [string]$MongoHost = "localhost",
    [int]$MongoPort = 27017,
    [string]$Database = "tradingagents",
    [string]$SourceDir = "C:\TradingAgentsCN",
    [string]$BackupDir = "C:\Backups\TradingAgents",
    [int]$RetentionDays = 30  # ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
)

# åˆ›å»ºå¤‡ä»½ç›®å½•
$backupDate = Get-Date -Format "yyyyMMdd_HHmmss"
$todayBackup = Join-Path $BackupDir $backupDate
New-Item -ItemType Directory -Path $todayBackup -Force | Out-Null

Write-Host "ğŸ”„ å¼€å§‹å®Œæ•´å¤‡ä»½ TradingAgents..." -ForegroundColor Cyan
Write-Host "ğŸ“… å¤‡ä»½æ—¶é—´: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" -ForegroundColor Yellow

# 1. å¤‡ä»½ MongoDB æ•°æ®åº“
Write-Host "`nï¿½ [1/3] å¤‡ä»½ MongoDB æ•°æ®åº“..." -ForegroundColor Yellow
$mongoBackupDir = Join-Path $todayBackup "mongodb"
try {
    mongodump --host $MongoHost --port $MongoPort --db $Database --out $mongoBackupDir --quiet
    if ($LASTEXITCODE -eq 0) {
        $mongoSize = (Get-ChildItem -Path $mongoBackupDir -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
        Write-Host "   âœ… MongoDB å¤‡ä»½æˆåŠŸ ($([math]::Round($mongoSize, 2)) MB)" -ForegroundColor Green
    } else {
        Write-Host "   âŒ MongoDB å¤‡ä»½å¤±è´¥ï¼" -ForegroundColor Red
        exit 1
    }
} catch {
    Write-Host "   âŒ MongoDB å¤‡ä»½å‡ºé”™ï¼š$_" -ForegroundColor Red
    exit 1
}

# 2. å¤‡ä»½é…ç½®æ–‡ä»¶
Write-Host "`nï¿½ [2/3] å¤‡ä»½é…ç½®æ–‡ä»¶..." -ForegroundColor Yellow
$configBackupDir = Join-Path $todayBackup "config"
New-Item -ItemType Directory -Path $configBackupDir -Force | Out-Null

Copy-Item -Path "$SourceDir\.env" -Destination $configBackupDir -ErrorAction SilentlyContinue
Copy-Item -Path "$SourceDir\config\*.json" -Destination $configBackupDir -ErrorAction SilentlyContinue
Write-Host "   âœ… é…ç½®æ–‡ä»¶å¤‡ä»½æˆåŠŸ" -ForegroundColor Green

# 3. å¤‡ä»½æ—¥å¿—æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œæœ€è¿‘7å¤©ï¼‰
Write-Host "`nğŸ“ [3/3] å¤‡ä»½æœ€è¿‘æ—¥å¿—..." -ForegroundColor Yellow
$logBackupDir = Join-Path $todayBackup "logs"
New-Item -ItemType Directory -Path $logBackupDir -Force | Out-Null

$sevenDaysAgo = (Get-Date).AddDays(-7)
Get-ChildItem -Path "$SourceDir\logs" -File |
    Where-Object { $_.LastWriteTime -gt $sevenDaysAgo } |
    Copy-Item -Destination $logBackupDir -ErrorAction SilentlyContinue
Write-Host "   âœ… æ—¥å¿—æ–‡ä»¶å¤‡ä»½æˆåŠŸ" -ForegroundColor Green

# 4. å‹ç¼©å¤‡ä»½
Write-Host "`nğŸ—œï¸  å‹ç¼©å¤‡ä»½æ–‡ä»¶..." -ForegroundColor Yellow
$zipFile = "$todayBackup.zip"
Compress-Archive -Path $todayBackup -DestinationPath $zipFile -Force

# åˆ é™¤æœªå‹ç¼©çš„å¤‡ä»½ç›®å½•
Remove-Item -Path $todayBackup -Recurse -Force

# 5. æ¸…ç†æ—§å¤‡ä»½
Write-Host "ğŸ§¹ æ¸…ç†æ—§å¤‡ä»½..." -ForegroundColor Yellow
$cutoffDate = (Get-Date).AddDays(-$RetentionDays)
$deletedCount = 0
Get-ChildItem -Path $BackupDir -Filter "*.zip" |
    Where-Object { $_.CreationTime -lt $cutoffDate } |
    ForEach-Object {
        Remove-Item $_.FullName -Force
        $deletedCount++
    }
Write-Host "   ğŸ—‘ï¸  åˆ é™¤äº† $deletedCount ä¸ªæ—§å¤‡ä»½" -ForegroundColor Gray

# 6. æ˜¾ç¤ºå¤‡ä»½æ‘˜è¦
Write-Host "`nâœ… å¤‡ä»½å®Œæˆï¼" -ForegroundColor Green
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor Gray
Write-Host "ğŸ“¦ å¤‡ä»½æ–‡ä»¶ï¼š$zipFile" -ForegroundColor Cyan
Write-Host "ğŸ“Š å¤‡ä»½å¤§å°ï¼š$([math]::Round((Get-Item $zipFile).Length / 1MB, 2)) MB" -ForegroundColor Cyan
Write-Host "ğŸ“… å¤‡ä»½æ—¶é—´ï¼š$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" -ForegroundColor Cyan
Write-Host "ğŸ—‚ï¸  ä¿ç•™å¤©æ•°ï¼š$RetentionDays å¤©" -ForegroundColor Cyan
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor Gray
```

#### è®¾ç½® Windows å®šæ—¶ä»»åŠ¡

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"ï¼ˆTask Schedulerï¼‰
2. ç‚¹å‡»"åˆ›å»ºåŸºæœ¬ä»»åŠ¡"
3. è®¾ç½®ä»»åŠ¡åç§°ï¼š`TradingAgents è‡ªåŠ¨å¤‡ä»½`
4. è®¾ç½®è§¦å‘å™¨ï¼š
   - **æ¯å¤©å‡Œæ™¨ 2:00**ï¼ˆæ¨èï¼‰
   - æˆ–**æ¯å‘¨æ—¥å‡Œæ™¨ 2:00**
5. æ“ä½œï¼šå¯åŠ¨ç¨‹åº
   - ç¨‹åºï¼š`powershell.exe`
   - å‚æ•°ï¼š`-ExecutionPolicy Bypass -File "C:\TradingAgentsCN\scripts\backup\auto_backup_all.ps1"`
6. å®Œæˆè®¾ç½®

#### Linux / macOS å®šæ—¶ä»»åŠ¡ï¼ˆCronï¼‰

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨ 2:00 æ‰§è¡Œï¼‰
0 2 * * * /opt/TradingAgentsCN/scripts/backup/backup_mongodb.sh >> /var/log/tradingagents_backup.log 2>&1
```

---

## 3. æ•°æ®è¿˜åŸ

### 3.1 MongoDB å®Œæ•´è¿˜åŸ

**åœºæ™¯**ï¼šç³»ç»Ÿå´©æºƒã€é‡è£…ç³»ç»Ÿã€è¿ç§»åˆ°æ–°ç”µè„‘

#### æ­¥éª¤ 1ï¼šå‡†å¤‡æ–°ç¯å¢ƒ

```bash
# 1. å®‰è£… MongoDB
# Windows: ä¸‹è½½ MongoDB Community Server
# Linux: sudo apt-get install mongodb-org

# 2. å¯åŠ¨ MongoDB æœåŠ¡
# Windows: net start MongoDB
# Linux: sudo systemctl start mongod

# 3. ç¡®ä¿ MongoDB æ­£å¸¸è¿è¡Œ
mongo --eval "db.version()"
```

#### æ­¥éª¤ 2ï¼šè¿˜åŸ MongoDB æ•°æ®

##### Windows è¿˜åŸè„šæœ¬

```powershell
# MongoDB æ•°æ®è¿˜åŸè„šæœ¬
# ä¿å­˜ä¸ºï¼šscripts/restore/restore_mongodb.ps1

param(
    [string]$BackupFile = "C:\Backups\TradingAgents\20251106_020000.zip",
    [string]$MongoHost = "localhost",
    [int]$MongoPort = 27017,
    [string]$Database = "tradingagents",
    [switch]$Drop = $false  # æ˜¯å¦åˆ é™¤ç°æœ‰æ•°æ®åº“
)

Write-Host "ğŸ”„ å¼€å§‹è¿˜åŸ MongoDB æ•°æ®åº“..." -ForegroundColor Cyan
Write-Host "ğŸ“¦ å¤‡ä»½æ–‡ä»¶: $BackupFile" -ForegroundColor Yellow
Write-Host "ğŸ“Š ç›®æ ‡æ•°æ®åº“: $Database" -ForegroundColor Yellow

# 1. è§£å‹å¤‡ä»½æ–‡ä»¶
$tempDir = "C:\Temp\MongoDB_Restore_$(Get-Date -Format 'yyyyMMdd_HHmmss')"
Write-Host "`nğŸ“‚ è§£å‹å¤‡ä»½æ–‡ä»¶..." -ForegroundColor Yellow
Expand-Archive -Path $BackupFile -DestinationPath $tempDir -Force

# æŸ¥æ‰¾ MongoDB å¤‡ä»½ç›®å½•
$mongoBackupDir = Get-ChildItem -Path $tempDir -Directory -Recurse -Filter "mongodb" | Select-Object -First 1
if (-not $mongoBackupDir) {
    Write-Host "âŒ æœªæ‰¾åˆ° MongoDB å¤‡ä»½ç›®å½•ï¼" -ForegroundColor Red
    Remove-Item -Path $tempDir -Recurse -Force
    exit 1
}

# 2. æ‰§è¡Œ mongorestore
Write-Host "`nğŸ“Š è¿˜åŸ MongoDB æ•°æ®..." -ForegroundColor Yellow
try {
    $restoreArgs = @(
        "--host", $MongoHost,
        "--port", $MongoPort,
        "--db", $Database,
        "$($mongoBackupDir.FullName)\$Database"
    )

    if ($Drop) {
        Write-Host "âš ï¸  è­¦å‘Šï¼šå°†åˆ é™¤ç°æœ‰æ•°æ®åº“ï¼" -ForegroundColor Red
        $restoreArgs += "--drop"
    }

    & mongorestore $restoreArgs

    if ($LASTEXITCODE -eq 0) {
        Write-Host "`nâœ… MongoDB æ•°æ®è¿˜åŸæˆåŠŸï¼" -ForegroundColor Green
    } else {
        Write-Host "`nâŒ MongoDB æ•°æ®è¿˜åŸå¤±è´¥ï¼" -ForegroundColor Red
        exit 1
    }
} catch {
    Write-Host "`nâŒ è¿˜åŸè¿‡ç¨‹å‡ºé”™ï¼š$_" -ForegroundColor Red
    exit 1
} finally {
    # 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    Write-Host "`nğŸ§¹ æ¸…ç†ä¸´æ—¶æ–‡ä»¶..." -ForegroundColor Yellow
    Remove-Item -Path $tempDir -Recurse -Force
}

# 4. éªŒè¯è¿˜åŸç»“æœ
Write-Host "`nğŸ” éªŒè¯è¿˜åŸç»“æœ..." -ForegroundColor Yellow
$collections = mongo $Database --quiet --eval "db.getCollectionNames().join(',')"
Write-Host "   ğŸ“‹ é›†åˆåˆ—è¡¨: $collections" -ForegroundColor Cyan

$docCount = mongo $Database --quiet --eval "db.stock_daily_quotes.count()"
Write-Host "   ğŸ“Š è‚¡ç¥¨æ•°æ®æ¡æ•°: $docCount" -ForegroundColor Cyan

Write-Host "`nâœ… è¿˜åŸå®Œæˆï¼" -ForegroundColor Green
```

##### Linux / macOS è¿˜åŸè„šæœ¬

```bash
#!/bin/bash
# MongoDB æ•°æ®è¿˜åŸè„šæœ¬
# ä¿å­˜ä¸ºï¼šscripts/restore/restore_mongodb.sh

BACKUP_FILE="/backups/TradingAgents/20251106_020000.tar.gz"
MONGO_HOST="localhost"
MONGO_PORT=27017
DATABASE="tradingagents"
DROP_DB=false  # æ˜¯å¦åˆ é™¤ç°æœ‰æ•°æ®åº“

echo "ğŸ”„ å¼€å§‹è¿˜åŸ MongoDB æ•°æ®åº“..."
echo "ğŸ“¦ å¤‡ä»½æ–‡ä»¶: $BACKUP_FILE"
echo "ğŸ“Š ç›®æ ‡æ•°æ®åº“: $DATABASE"

# 1. è§£å‹å¤‡ä»½æ–‡ä»¶
TEMP_DIR="/tmp/MongoDB_Restore_$(date +%Y%m%d_%H%M%S)"
echo -e "\nğŸ“‚ è§£å‹å¤‡ä»½æ–‡ä»¶..."
mkdir -p "$TEMP_DIR"
tar -xzf "$BACKUP_FILE" -C "$TEMP_DIR"

# æŸ¥æ‰¾ MongoDB å¤‡ä»½ç›®å½•
MONGO_BACKUP_DIR=$(find "$TEMP_DIR" -type d -name "mongodb" | head -n 1)
if [ -z "$MONGO_BACKUP_DIR" ]; then
    echo "âŒ æœªæ‰¾åˆ° MongoDB å¤‡ä»½ç›®å½•ï¼"
    rm -rf "$TEMP_DIR"
    exit 1
fi

# 2. æ‰§è¡Œ mongorestore
echo -e "\nğŸ“Š è¿˜åŸ MongoDB æ•°æ®..."
RESTORE_ARGS="--host $MONGO_HOST --port $MONGO_PORT --db $DATABASE $MONGO_BACKUP_DIR/$DATABASE"

if [ "$DROP_DB" = true ]; then
    echo "âš ï¸  è­¦å‘Šï¼šå°†åˆ é™¤ç°æœ‰æ•°æ®åº“ï¼"
    RESTORE_ARGS="$RESTORE_ARGS --drop"
fi

mongorestore $RESTORE_ARGS

if [ $? -eq 0 ]; then
    echo -e "\nâœ… MongoDB æ•°æ®è¿˜åŸæˆåŠŸï¼"
else
    echo -e "\nâŒ MongoDB æ•°æ®è¿˜åŸå¤±è´¥ï¼"
    rm -rf "$TEMP_DIR"
    exit 1
fi

# 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
echo -e "\nğŸ§¹ æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
rm -rf "$TEMP_DIR"

# 4. éªŒè¯è¿˜åŸç»“æœ
echo -e "\nğŸ” éªŒè¯è¿˜åŸç»“æœ..."
COLLECTIONS=$(mongo $DATABASE --quiet --eval "db.getCollectionNames().join(',')")
echo "   ğŸ“‹ é›†åˆåˆ—è¡¨: $COLLECTIONS"

DOC_COUNT=$(mongo $DATABASE --quiet --eval "db.stock_daily_quotes.count()")
echo "   ğŸ“Š è‚¡ç¥¨æ•°æ®æ¡æ•°: $DOC_COUNT"

echo -e "\nâœ… è¿˜åŸå®Œæˆï¼"
```

##### ä½¿ç”¨æ–¹æ³•

```bash
# Windows - è¿˜åŸæ•°æ®ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
powershell -ExecutionPolicy Bypass -File scripts/restore/restore_mongodb.ps1 `
    -BackupFile "C:\Backups\TradingAgents\20251106_020000.zip"

# Windows - è¿˜åŸæ•°æ®ï¼ˆåˆ é™¤ç°æœ‰æ•°æ®ï¼‰
powershell -ExecutionPolicy Bypass -File scripts/restore/restore_mongodb.ps1 `
    -BackupFile "C:\Backups\TradingAgents\20251106_020000.zip" `
    -Drop

# Linux / macOS
chmod +x scripts/restore/restore_mongodb.sh
./scripts/restore/restore_mongodb.sh
```

#### æ­¥éª¤ 3ï¼šè¿˜åŸé…ç½®æ–‡ä»¶

```bash
# Windows PowerShell
$backupZip = "C:\Backups\TradingAgents\20251106_020000.zip"
$tempDir = "C:\Temp\Config_Restore"

# è§£å‹
Expand-Archive -Path $backupZip -DestinationPath $tempDir -Force

# è¿˜åŸé…ç½®æ–‡ä»¶
Copy-Item -Path "$tempDir\config\.env" -Destination "C:\TradingAgentsCN\" -Force
Copy-Item -Path "$tempDir\config\*.json" -Destination "C:\TradingAgentsCN\config\" -Force

# æ¸…ç†
Remove-Item -Path $tempDir -Recurse -Force

Write-Host "âœ… é…ç½®æ–‡ä»¶è¿˜åŸå®Œæˆ" -ForegroundColor Green
```

#### æ­¥éª¤ 4ï¼šéªŒè¯è¿˜åŸ

```bash
# Windows PowerShell
# 1. æ£€æŸ¥ MongoDB è¿æ¥
mongo tradingagents --eval "db.stats()"

# 2. æ£€æŸ¥æ•°æ®é‡
mongo tradingagents --eval "db.stock_daily_quotes.count()"

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶
Get-Content "C:\TradingAgentsCN\.env" | Select-String "TUSHARE_TOKEN"

# 4. å¯åŠ¨æœåŠ¡æµ‹è¯•
cd C:\TradingAgentsCN
python -m tradingagents.cli start
```

---

### 3.2 é€‰æ‹©æ€§è¿˜åŸ

**åœºæ™¯**ï¼šåªéœ€è¦è¿˜åŸéƒ¨åˆ†æ•°æ®

#### åªè¿˜åŸç‰¹å®šé›†åˆ

```bash
# Windows PowerShell
# åªè¿˜åŸè‚¡ç¥¨åŸºæœ¬ä¿¡æ¯å’Œé…ç½®
$backupZip = "C:\Backups\TradingAgents\20251106_020000.zip"
$tempDir = "C:\Temp\Partial_Restore"

# è§£å‹
Expand-Archive -Path $backupZip -DestinationPath $tempDir -Force

# æŸ¥æ‰¾ MongoDB å¤‡ä»½ç›®å½•
$mongoBackupDir = Get-ChildItem -Path $tempDir -Directory -Recurse -Filter "mongodb" | Select-Object -First 1

# åªè¿˜åŸç‰¹å®šé›†åˆ
mongorestore --host localhost --port 27017 `
    --db tradingagents `
    --collection stock_basic_info `
    "$($mongoBackupDir.FullName)\tradingagents\stock_basic_info.bson"

mongorestore --host localhost --port 27017 `
    --db tradingagents `
    --collection system_config `
    "$($mongoBackupDir.FullName)\tradingagents\system_config.bson"

# æ¸…ç†
Remove-Item -Path $tempDir -Recurse -Force
```

#### åªè¿˜åŸç‰¹å®šæ—¥æœŸèŒƒå›´çš„æ•°æ®

```bash
# ä½¿ç”¨ MongoDB æŸ¥è¯¢è¿˜åŸç‰¹å®šæ—¥æœŸçš„æ•°æ®
# 1. å…ˆå®Œæ•´è¿˜åŸåˆ°ä¸´æ—¶æ•°æ®åº“
mongorestore --host localhost --port 27017 --db temp_restore backup/tradingagents

# 2. ä»ä¸´æ—¶æ•°æ®åº“å¤åˆ¶ç‰¹å®šæ—¥æœŸçš„æ•°æ®
mongo tradingagents --eval '
db.stock_daily_quotes.insertMany(
    db.getSiblingDB("temp_restore").stock_daily_quotes.find({
        trade_date: { $gte: "2025-01-01", $lte: "2025-11-06" }
    }).toArray()
)
'

# 3. åˆ é™¤ä¸´æ—¶æ•°æ®åº“
mongo temp_restore --eval "db.dropDatabase()"
```

---

## 4. ç‰ˆæœ¬å‡çº§

### 4.1 å‡çº§å‰å‡†å¤‡

#### âœ… å‡çº§å‰æ£€æŸ¥æ¸…å•

- [ ] é˜…è¯»æ–°ç‰ˆæœ¬çš„ Release Notes
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰ç ´åæ€§å˜æ›´ï¼ˆBreaking Changesï¼‰
- [ ] å®Œæ•´å¤‡ä»½å½“å‰ç‰ˆæœ¬ï¼ˆå‚è€ƒ 2.2 èŠ‚ï¼‰
- [ ] è®°å½•å½“å‰ç‰ˆæœ¬å·
- [ ] ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
- [ ] å…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ TradingAgents è¿›ç¨‹

#### æŸ¥çœ‹å½“å‰ç‰ˆæœ¬

```bash
# æ–¹æ³• 1ï¼šæŸ¥çœ‹ä»£ç 
python -c "import tradingagents; print(tradingagents.__version__)"

# æ–¹æ³• 2ï¼šæŸ¥çœ‹ git æ ‡ç­¾
cd C:\TradingAgentsCN
git describe --tags

# æ–¹æ³• 3ï¼šæŸ¥çœ‹ README
Get-Content README.md | Select-String "ç‰ˆæœ¬"
```

---

### 4.2 å‡çº§æ­¥éª¤

#### æ–¹æ³• 1ï¼šåŸåœ°å‡çº§ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼šä¿ç•™æ‰€æœ‰æ•°æ®å’Œé…ç½®  
**ç¼ºç‚¹**ï¼šå¦‚æœå‡çº§å¤±è´¥ï¼Œéœ€è¦è¿˜åŸå¤‡ä»½

```bash
# Windows PowerShell
cd C:\TradingAgentsCN

# 1. åœæ­¢æœåŠ¡
Stop-Process -Name "python" -Force

# 2. å¤‡ä»½å½“å‰ç‰ˆæœ¬
$backupDate = Get-Date -Format "yyyyMMdd_HHmmss"
Copy-Item -Path ".env" -Destination ".env.backup_$backupDate"
Copy-Item -Path "config" -Destination "config.backup_$backupDate" -Recurse

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git fetch --all
git pull origin main

# 4. æ›´æ–°ä¾èµ–
pip install -r requirements.txt --upgrade

# 5. æ£€æŸ¥é…ç½®æ–‡ä»¶å˜åŒ–
# å¯¹æ¯” .env.example å’Œ .envï¼Œçœ‹æ˜¯å¦æœ‰æ–°å¢é…ç½®é¡¹
code --diff .env.example .env

# 6. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœæœ‰ï¼‰
python scripts/setup/migrate_database.py

# 7. é‡å¯æœåŠ¡
python -m tradingagents.cli start
```

#### æ–¹æ³• 2ï¼šå¹¶è¡Œå‡çº§ï¼ˆæœ€å®‰å…¨ï¼‰

**ä¼˜ç‚¹**ï¼šæ–°æ—§ç‰ˆæœ¬å…±å­˜ï¼Œå¯ä»¥å¯¹æ¯”æµ‹è¯•  
**ç¼ºç‚¹**ï¼šå ç”¨æ›´å¤šç£ç›˜ç©ºé—´

```bash
# Windows PowerShell
# 1. ä¸‹è½½æ–°ç‰ˆæœ¬åˆ°æ–°ç›®å½•
cd C:\
git clone https://github.com/yourusername/TradingAgentsCN.git TradingAgentsCN_v2

# 2. å¤åˆ¶é…ç½®æ–‡ä»¶
Copy-Item -Path "C:\TradingAgentsCN\.env" -Destination "C:\TradingAgentsCN_v2\"

# 3. å¤åˆ¶æ•°æ®æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œå¦‚æœæ•°æ®é‡å¤§å¯ä»¥å…±äº«ï¼‰
# æ–¹å¼ Aï¼šå¤åˆ¶æ•°æ®
Copy-Item -Path "C:\TradingAgentsCN\data" -Destination "C:\TradingAgentsCN_v2\data" -Recurse

# æ–¹å¼ Bï¼šåˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆå…±äº«æ•°æ®ï¼‰
New-Item -ItemType SymbolicLink -Path "C:\TradingAgentsCN_v2\data" -Target "C:\TradingAgentsCN\data"

# 4. å®‰è£…ä¾èµ–
cd C:\TradingAgentsCN_v2
pip install -r requirements.txt

# 5. æµ‹è¯•æ–°ç‰ˆæœ¬
python -m tradingagents.cli --version

# 6. å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œåœæ­¢æ—§ç‰ˆæœ¬ï¼Œå¯åŠ¨æ–°ç‰ˆæœ¬
# å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œç»§ç»­ä½¿ç”¨æ—§ç‰ˆæœ¬
```

---

### 4.3 å‡çº§åéªŒè¯

#### éªŒè¯æ¸…å•

```bash
# 1. æ£€æŸ¥ç‰ˆæœ¬å·
python -c "import tradingagents; print(tradingagents.__version__)"

# 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
python -c "from tradingagents.config import get_config; print(get_config())"

# 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
python scripts/validation/check_dependencies.py

# 4. è¿è¡Œæµ‹è¯•
python -m pytest tests/ -v

# 5. æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
python scripts/validation/test_market_analyst_lookback.py

# 6. æŸ¥çœ‹æ—¥å¿—
Get-Content logs/tradingagents.log -Tail 50
```

#### å¸¸è§å‡çº§é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| é…ç½®æ–‡ä»¶ç¼ºå°‘æ–°å‚æ•° | æ–°ç‰ˆæœ¬å¢åŠ äº†é…ç½®é¡¹ | å¯¹æ¯” `.env.example`ï¼Œæ·»åŠ ç¼ºå¤±çš„é…ç½® |
| ä¾èµ–åŒ…ç‰ˆæœ¬å†²çª | requirements.txt æ›´æ–° | `pip install -r requirements.txt --upgrade --force-reinstall` |
| æ•°æ®åº“ç»“æ„å˜åŒ– | æ•°æ®æ¨¡å‹æ›´æ–° | è¿è¡Œè¿ç§»è„šæœ¬ `python scripts/setup/migrate_database.py` |
| æç¤ºè¯æ¨¡æ¿ä¸å…¼å®¹ | æç¤ºè¯æ ¼å¼å˜åŒ– | åˆ é™¤ `prompts/` ç›®å½•ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬çš„é»˜è®¤æ¨¡æ¿ |

---

## 5. å¸¸è§é—®é¢˜

### Q1: MongoDB å¤‡ä»½æ–‡ä»¶å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ

**A**: æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å‡å°å¤‡ä»½æ–‡ä»¶å¤§å°ï¼š

#### æ–¹æ³• 1ï¼šåªå¤‡ä»½é‡è¦é›†åˆ

```bash
# åªå¤‡ä»½è‚¡ç¥¨æ•°æ®å’Œé…ç½®ï¼Œä¸å¤‡ä»½æ—¥å¿—å’Œä¸´æ—¶æ•°æ®
mongodump --host localhost --port 27017 --db tradingagents \
    --collection stock_daily_quotes \
    --collection stock_basic_info \
    --collection system_config \
    --out /backups/mongodb_essential
```

#### æ–¹æ³• 2ï¼šå¤‡ä»½ç‰¹å®šæ—¥æœŸèŒƒå›´

```bash
# åªå¤‡ä»½æœ€è¿‘3ä¸ªæœˆçš„æ•°æ®
$threeMonthsAgo = (Get-Date).AddMonths(-3).ToString("yyyy-MM-dd")
mongodump --host localhost --port 27017 --db tradingagents \
    --collection stock_daily_quotes \
    --query "{trade_date: {\$gte: '$threeMonthsAgo'}}" \
    --out /backups/mongodb_recent
```

#### æ–¹æ³• 3ï¼šä½¿ç”¨å‹ç¼©

```bash
# mongodump è‡ªå¸¦å‹ç¼©åŠŸèƒ½
mongodump --host localhost --port 27017 --db tradingagents \
    --gzip \
    --out /backups/mongodb_compressed
```

---

### Q2: è¿˜åŸæ•°æ®æ—¶æç¤º"duplicate key error"æ€ä¹ˆåŠï¼Ÿ

**A**: è¿™æ˜¯å› ä¸ºç›®æ ‡æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ç›¸åŒçš„æ•°æ®ã€‚æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ 1ï¼šåˆ é™¤ç°æœ‰æ•°æ®åº“åè¿˜åŸï¼ˆæ¨èï¼‰

```bash
# Windows PowerShell
# ä½¿ç”¨ --drop å‚æ•°
mongorestore --host localhost --port 27017 --db tradingagents --drop backup/tradingagents
```

#### æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨åˆ é™¤å†²çªçš„é›†åˆ

```bash
# åˆ é™¤ç‰¹å®šé›†åˆ
mongo tradingagents --eval "db.stock_daily_quotes.drop()"

# ç„¶åè¿˜åŸ
mongorestore --host localhost --port 27017 --db tradingagents backup/tradingagents
```

---

### Q3: å¦‚ä½•éªŒè¯å¤‡ä»½æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Ÿ

**A**: å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•éªŒè¯ï¼š

```bash
# Windows PowerShell
# 1. æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å¤§å°
$backupFile = "C:\Backups\TradingAgents\20251106_020000.zip"
$fileSize = [math]::Round((Get-Item $backupFile).Length / 1MB, 2)
Write-Host "å¤‡ä»½æ–‡ä»¶å¤§å°: $fileSize MB"

# 2. è§£å‹å¹¶æ£€æŸ¥å†…å®¹
$tempDir = "C:\Temp\Verify_Backup"
Expand-Archive -Path $backupFile -DestinationPath $tempDir -Force

# 3. æ£€æŸ¥ MongoDB å¤‡ä»½ç›®å½•
$mongoBackupDir = Get-ChildItem -Path $tempDir -Directory -Recurse -Filter "mongodb"
if ($mongoBackupDir) {
    Write-Host "âœ… MongoDB å¤‡ä»½ç›®å½•å­˜åœ¨"
    Get-ChildItem -Path $mongoBackupDir.FullName -Recurse | Measure-Object -Property Length -Sum
} else {
    Write-Host "âŒ MongoDB å¤‡ä»½ç›®å½•ä¸å­˜åœ¨"
}

# 4. æ£€æŸ¥é…ç½®æ–‡ä»¶
if (Test-Path "$tempDir\config\.env") {
    Write-Host "âœ… é…ç½®æ–‡ä»¶å­˜åœ¨"
} else {
    Write-Host "âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨"
}

# æ¸…ç†
Remove-Item -Path $tempDir -Recurse -Force
```

---

### Q4: å¦‚ä½•åœ¨å¤šå°ç”µè„‘ä¹‹é—´åŒæ­¥æ•°æ®ï¼Ÿ

**A**: æœ‰å‡ ç§æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ MongoDB å‰¯æœ¬é›†ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# é…ç½® MongoDB å‰¯æœ¬é›†ï¼Œå®ç°è‡ªåŠ¨åŒæ­¥
# å‚è€ƒ MongoDB å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.mongodb.com/manual/replication/
```

#### æ–¹æ¡ˆ 2ï¼šå®šæœŸå¤‡ä»½å¹¶åŒæ­¥åˆ°äº‘å­˜å‚¨

```bash
# 1. å¤‡ä»½åˆ°æœ¬åœ°
powershell -File scripts/backup/backup_mongodb.ps1

# 2. åŒæ­¥åˆ°äº‘å­˜å‚¨ï¼ˆä¾‹å¦‚ OneDriveï¼‰
$backupFile = Get-ChildItem "C:\Backups\TradingAgents" -Filter "*.zip" |
    Sort-Object CreationTime -Descending |
    Select-Object -First 1

Copy-Item -Path $backupFile.FullName -Destination "D:\OneDrive\TradingAgents\Backups\"
```

#### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ MongoDB Atlasï¼ˆäº‘æ•°æ®åº“ï¼‰

```bash
# å°†æ•°æ®è¿ç§»åˆ° MongoDB Atlas
# æ‰€æœ‰ç”µè„‘è¿æ¥åˆ°åŒä¸€ä¸ªäº‘æ•°æ®åº“
# ä¿®æ”¹ .env æ–‡ä»¶ï¼š
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/tradingagents
```

---

### Q5: å‡çº§å MongoDB æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ

**A**: ä»æœ€è¿‘çš„å¤‡ä»½è¿˜åŸï¼š

```bash
# 1. æŸ¥æ‰¾æœ€è¿‘çš„å¤‡ä»½
Get-ChildItem "C:\Backups\TradingAgents" -Filter "*.zip" |
    Sort-Object CreationTime -Descending |
    Select-Object -First 1

# 2. è¿˜åŸ MongoDB æ•°æ®
$latestBackup = "C:\Backups\TradingAgents\20251106_020000.zip"
powershell -ExecutionPolicy Bypass -File scripts/restore/restore_mongodb.ps1 `
    -BackupFile $latestBackup `
    -Drop

# 3. éªŒè¯æ•°æ®
mongo tradingagents --eval "db.stock_daily_quotes.count()"
```

---

### Q6: å¦‚ä½•è¿ç§»åˆ°æ–°ç”µè„‘ï¼Ÿ

**A**: å®Œæ•´è¿ç§»æ­¥éª¤ï¼š

#### æ­¥éª¤ 1ï¼šåœ¨æ—§ç”µè„‘ä¸Šå¤‡ä»½

```bash
# 1. å¤‡ä»½ MongoDB
powershell -File scripts/backup/backup_mongodb.ps1

# 2. å¤‡ä»½é…ç½®æ–‡ä»¶
Copy-Item -Path "C:\TradingAgentsCN\.env" -Destination "C:\Backups\TradingAgents\"
Copy-Item -Path "C:\TradingAgentsCN\config" -Destination "C:\Backups\TradingAgents\config" -Recurse
```

#### æ­¥éª¤ 2ï¼šä¼ è¾“å¤‡ä»½æ–‡ä»¶

```bash
# ä½¿ç”¨ U ç›˜ã€ç½‘ç»œå…±äº«æˆ–äº‘å­˜å‚¨ä¼ è¾“å¤‡ä»½æ–‡ä»¶åˆ°æ–°ç”µè„‘
```

#### æ­¥éª¤ 3ï¼šåœ¨æ–°ç”µè„‘ä¸Šè¿˜åŸ

```bash
# 1. å®‰è£… Pythonã€MongoDB
# 2. ä¸‹è½½ TradingAgents ç»¿è‰²ç‰ˆ
# 3. è¿˜åŸ MongoDB æ•°æ®
powershell -File scripts/restore/restore_mongodb.ps1 -BackupFile "å¤‡ä»½æ–‡ä»¶è·¯å¾„"

# 4. è¿˜åŸé…ç½®æ–‡ä»¶
Copy-Item -Path "å¤‡ä»½ç›®å½•\.env" -Destination "C:\TradingAgentsCN\"
Copy-Item -Path "å¤‡ä»½ç›®å½•\config\*" -Destination "C:\TradingAgentsCN\config\"

# 5. å¯åŠ¨æœåŠ¡
python -m tradingagents.cli start
```

---

### Q7: å¦‚ä½•å›æ»šåˆ°æ—§ç‰ˆæœ¬ï¼Ÿ

**A**: ä½¿ç”¨ git å›æ»šä»£ç ï¼Œç„¶åè¿˜åŸå¯¹åº”ç‰ˆæœ¬çš„æ•°æ®ï¼š

```bash
# 1. å¤‡ä»½å½“å‰æ•°æ®
powershell -File scripts/backup/backup_mongodb.ps1

# 2. å›æ»šä»£ç åˆ°æ—§ç‰ˆæœ¬
cd C:\TradingAgentsCN
git log --oneline --decorate
git checkout v1.0.0

# 3. å¦‚æœæ•°æ®ç»“æ„æœ‰å˜åŒ–ï¼Œè¿˜åŸæ—§ç‰ˆæœ¬çš„æ•°æ®å¤‡ä»½
powershell -File scripts/restore/restore_mongodb.ps1 `
    -BackupFile "C:\Backups\TradingAgents\v1.0.0_backup.zip" `
    -Drop

# 4. é‡å¯æœåŠ¡
python -m tradingagents.cli start
```

---

## 6. æœ€ä½³å®è·µ

### ğŸ“… å¤‡ä»½ç­–ç•¥å»ºè®®

#### MongoDB æ•°æ®å¤‡ä»½ç­–ç•¥

| å¤‡ä»½ç±»å‹ | é¢‘ç‡ | ä¿ç•™æ—¶é—´ | å¤‡ä»½å†…å®¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|---------|---------|
| **å®Œæ•´å¤‡ä»½** | æ¯å‘¨æ—¥å‡Œæ™¨ | 4å‘¨ | æ‰€æœ‰ MongoDB æ•°æ® + é…ç½® | é‡å¤§ç‰ˆæœ¬å‡çº§å‰ |
| **å¢é‡å¤‡ä»½** | æ¯å¤©å‡Œæ™¨ 2:00 | 7å¤© | MongoDB æ•°æ® | æ—¥å¸¸ä½¿ç”¨ |
| **é…ç½®å¤‡ä»½** | ä¿®æ”¹é…ç½®åç«‹å³ | æ°¸ä¹… | .env + config/*.json | ä¿®æ”¹é…ç½®å‰ |
| **å‡çº§å‰å¤‡ä»½** | å‡çº§å‰ | æ°¸ä¹… | æ‰€æœ‰æ•°æ® + é…ç½® | ç‰ˆæœ¬å‡çº§ |
| **æµ‹è¯•å‰å¤‡ä»½** | æµ‹è¯•æ–°åŠŸèƒ½å‰ | æµ‹è¯•å®Œæˆå | ç›¸å…³æ•°æ® | åŠŸèƒ½æµ‹è¯• |

#### å¤‡ä»½ä¿ç•™ç­–ç•¥ï¼ˆ3-2-1 åŸåˆ™ï¼‰

- **3 ä»½å‰¯æœ¬**ï¼šåŸå§‹æ•°æ® + 2 ä»½å¤‡ä»½
- **2 ç§ä»‹è´¨**ï¼šæœ¬åœ°ç¡¬ç›˜ + äº‘å­˜å‚¨/ç§»åŠ¨ç¡¬ç›˜
- **1 ä»½å¼‚åœ°**ï¼šè‡³å°‘ 1 ä»½å¤‡ä»½å­˜å‚¨åœ¨ä¸åŒåœ°ç‚¹

```
ç¤ºä¾‹ï¼š
â”œâ”€ åŸå§‹æ•°æ®ï¼šC:\TradingAgentsCN\ï¼ˆMongoDB è¿è¡Œä¸­ï¼‰
â”œâ”€ æœ¬åœ°å¤‡ä»½ï¼šC:\Backups\TradingAgents\ï¼ˆæœ¬åœ°ç¡¬ç›˜ï¼‰
â”œâ”€ äº‘ç«¯å¤‡ä»½ï¼šOneDrive\TradingAgents\Backups\ï¼ˆäº‘å­˜å‚¨ï¼‰
â””â”€ å¼‚åœ°å¤‡ä»½ï¼šç§»åŠ¨ç¡¬ç›˜ï¼ˆæ¯å‘¨åŒæ­¥ä¸€æ¬¡ï¼‰
```

---

### ğŸ”’ å®‰å…¨å»ºè®®

#### 1. åŠ å¯†å¤‡ä»½æ–‡ä»¶

MongoDB å¤‡ä»½åŒ…å«æ•æ„Ÿçš„è‚¡ç¥¨æ•°æ®å’Œé…ç½®ä¿¡æ¯ï¼ŒåŠ¡å¿…åŠ å¯†ï¼š

```bash
# Windows - ä½¿ç”¨ 7-Zip åŠ å¯†
7z a -p"your_strong_password" -mhe=on `
    "C:\Backups\TradingAgents\encrypted_backup.7z" `
    "C:\Backups\TradingAgents\20251106_020000.zip"

# Linux - ä½¿ç”¨ GPG åŠ å¯†
gpg --symmetric --cipher-algo AES256 backup.tar.gz
```

#### 2. å¼‚åœ°å¤‡ä»½

**äº‘å­˜å‚¨å¤‡ä»½**ï¼š

```powershell
# è‡ªåŠ¨åŒæ­¥åˆ° OneDrive
$backupFile = Get-ChildItem "C:\Backups\TradingAgents" -Filter "*.zip" |
    Sort-Object CreationTime -Descending |
    Select-Object -First 1

# å¤åˆ¶åˆ° OneDrive
Copy-Item -Path $backupFile.FullName `
    -Destination "D:\OneDrive\TradingAgents\Backups\" `
    -Force

Write-Host "âœ… å¤‡ä»½å·²åŒæ­¥åˆ° OneDrive" -ForegroundColor Green
```

**ç§»åŠ¨ç¡¬ç›˜å¤‡ä»½**ï¼š

```bash
# æ¯å‘¨åŒæ­¥åˆ°ç§»åŠ¨ç¡¬ç›˜
robocopy "C:\Backups\TradingAgents" "E:\TradingAgents_Backups" /MIR /Z /W:5
```

#### 3. ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

```bash
# .env æ–‡ä»¶åŒ…å« API Tokenï¼Œå•ç‹¬åŠ å¯†å­˜å‚¨
$envFile = "C:\TradingAgentsCN\.env"
$encryptedEnv = "C:\Backups\Config\.env.encrypted"

# ä½¿ç”¨ Windows DPAPI åŠ å¯†
$content = Get-Content $envFile -Raw
$secureString = ConvertTo-SecureString $content -AsPlainText -Force
$encrypted = ConvertFrom-SecureString $secureString
Set-Content -Path $encryptedEnv -Value $encrypted
```

---

### âš¡ æ€§èƒ½ä¼˜åŒ–

#### 1. MongoDB å¤‡ä»½æ€§èƒ½ä¼˜åŒ–

```bash
# ä½¿ç”¨å¹¶è¡Œå¤‡ä»½ï¼ˆå¤šçº¿ç¨‹ï¼‰
mongodump --host localhost --port 27017 --db tradingagents \
    --numParallelCollections=4 \
    --gzip \
    --out /backups/mongodb

# åªå¤‡ä»½ç´¢å¼•å®šä¹‰ï¼Œä¸å¤‡ä»½ç´¢å¼•æ•°æ®ï¼ˆå‡å°å¤‡ä»½å¤§å°ï¼‰
mongodump --host localhost --port 27017 --db tradingagents \
    --excludeCollectionsWithPrefix=system. \
    --out /backups/mongodb
```

#### 2. å¢é‡å¤‡ä»½ï¼ˆå‡å°‘å¤‡ä»½æ—¶é—´ï¼‰

```bash
# é¦–æ¬¡å®Œæ•´å¤‡ä»½
mongodump --host localhost --port 27017 --db tradingagents \
    --out /backups/full_backup

# åç»­åªå¤‡ä»½å˜åŒ–çš„æ•°æ®ï¼ˆéœ€è¦ MongoDB å‰¯æœ¬é›†ï¼‰
mongodump --host localhost --port 27017 \
    --oplog \
    --out /backups/incremental_$(date +%Y%m%d)
```

#### 3. å‹ç¼©å¤‡ä»½æ–‡ä»¶

```bash
# mongodump è‡ªå¸¦ gzip å‹ç¼©ï¼ˆæ¨èï¼‰
mongodump --host localhost --port 27017 --db tradingagents \
    --gzip \
    --out /backups/mongodb_compressed

# å‹ç¼©ç‡å¯¹æ¯”ï¼š
# - ä¸å‹ç¼©ï¼š1000 MB
# - gzipï¼š200-300 MBï¼ˆå‹ç¼©ç‡ 70-80%ï¼‰
# - 7z æœ€é«˜å‹ç¼©ï¼š150-200 MBï¼ˆå‹ç¼©ç‡ 80-85%ï¼‰
```

#### 4. å¤‡ä»½æ—¶é¿å…å½±å“æ€§èƒ½

```bash
# åœ¨ MongoDB ä»èŠ‚ç‚¹ä¸Šå¤‡ä»½ï¼ˆä¸å½±å“ä¸»èŠ‚ç‚¹æ€§èƒ½ï¼‰
mongodump --host secondary-node --port 27017 --db tradingagents \
    --out /backups/mongodb

# æˆ–è€…åœ¨ä½å³°æ—¶æ®µå¤‡ä»½ï¼ˆå‡Œæ™¨ 2:00-4:00ï¼‰
```

---

### ğŸ“Š ç›‘æ§å’Œå‘Šè­¦

#### 1. å¤‡ä»½æˆåŠŸç‡ç›‘æ§

```powershell
# åœ¨å¤‡ä»½è„šæœ¬ä¸­æ·»åŠ æ—¥å¿—è®°å½•
$logFile = "C:\Logs\backup_history.log"
$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"

if ($LASTEXITCODE -eq 0) {
    Add-Content -Path $logFile -Value "$timestamp | SUCCESS | Backup completed"
} else {
    Add-Content -Path $logFile -Value "$timestamp | FAILED | Backup failed"

    # å‘é€å‘Šè­¦é‚®ä»¶
    Send-MailMessage -To "admin@example.com" `
        -From "backup@example.com" `
        -Subject "TradingAgents å¤‡ä»½å¤±è´¥" `
        -Body "å¤‡ä»½ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—" `
        -SmtpServer "smtp.example.com"
}
```

#### 2. å¤‡ä»½æ–‡ä»¶å¤§å°ç›‘æ§

```powershell
# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å¤§å°æ˜¯å¦å¼‚å¸¸
$backupFile = Get-ChildItem "C:\Backups\TradingAgents" -Filter "*.zip" |
    Sort-Object CreationTime -Descending |
    Select-Object -First 1

$fileSize = $backupFile.Length / 1MB

# å¦‚æœå¤‡ä»½æ–‡ä»¶å°äº 100MBï¼Œå¯èƒ½å¤‡ä»½ä¸å®Œæ•´
if ($fileSize -lt 100) {
    Write-Host "âš ï¸  è­¦å‘Šï¼šå¤‡ä»½æ–‡ä»¶å¼‚å¸¸å° ($fileSize MB)" -ForegroundColor Red
    # å‘é€å‘Šè­¦
}
```

---

### ğŸ§ª å®šæœŸæµ‹è¯•è¿˜åŸ

**é‡è¦**ï¼šå®šæœŸæµ‹è¯•å¤‡ä»½æ–‡ä»¶æ˜¯å¦å¯ä»¥æˆåŠŸè¿˜åŸï¼

```bash
# æ¯æœˆæµ‹è¯•ä¸€æ¬¡è¿˜åŸæµç¨‹
# 1. åœ¨æµ‹è¯•ç¯å¢ƒè¿˜åŸå¤‡ä»½
mongorestore --host test-server --port 27017 --db tradingagents_test \
    backup/tradingagents

# 2. éªŒè¯æ•°æ®å®Œæ•´æ€§
mongo tradingagents_test --eval "
    var count = db.stock_daily_quotes.count();
    print('æ•°æ®æ¡æ•°: ' + count);
    if (count < 1000) {
        print('âŒ æ•°æ®ä¸å®Œæ•´');
        quit(1);
    } else {
        print('âœ… æ•°æ®å®Œæ•´');
    }
"

# 3. æ¸…ç†æµ‹è¯•æ•°æ®
mongo tradingagents_test --eval "db.dropDatabase()"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®‰è£…æŒ‡å—](../guides/installation/README.md)
- [é…ç½®æŒ‡å—](../guides/configuration/README.md)
- [æ•…éšœæ’é™¤](../troubleshooting/common-issues/README.md)
- [å¼€å‘æ–‡æ¡£](../development/README.md)

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœåœ¨å¤‡ä»½ã€è¿˜åŸæˆ–å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ [å¸¸è§é—®é¢˜](../troubleshooting/common-issues/README.md)
2. æœç´¢ [GitHub Issues](https://github.com/yourusername/TradingAgentsCN/issues)
3. åŠ å…¥ç¤¾åŒºè®¨è®ºç¾¤
4. æäº¤æ–°çš„ Issue

---

**æœ€åæ›´æ–°**: 2025-11-06  
**é€‚ç”¨ç‰ˆæœ¬**: TradingAgents v1.0.0+

